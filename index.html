<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>KraveAI</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script>
  // set tema antes de pintar
  (function(){
    const saved = localStorage.getItem('theme');
    const prefersDark = matchMedia('(prefers-color-scheme: dark)').matches;
    document.documentElement.setAttribute('data-theme', saved || (prefersDark ? 'dark':'light'));
  })();
</script>
<style>
/* ======== TOKENS ======== */
:root{
  --bg:#ffffff; --surface:#ffffff; --muted-bg:#f3f5fa; --text:#0b1323; --muted:#64748b; --line:#e7ebf2;
  --a:#7c5cff; --b:#00d3c2; --ok:#22c55e; --err:#ef4444;
  --pill:#f7f8fc; --shadow:0 10px 28px rgba(16,24,40,.08);
  --r:16px; --gap:12px;
}
[data-theme="dark"]{
  --bg:#0b0d12; --surface:#0f1219; --muted-bg:#0f1524; --text:#eaf0f8; --muted:#9aa6be; --line:#1f2a40;
  --pill:#12182a; --shadow:0 18px 44px rgba(0,0,0,.35);
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 ui-sans-serif,system-ui,-apple-system,"SF Pro Text",Inter,Roboto}
a{color:inherit;text-decoration:none}
h1,h2,p{margin:0}

/* ======== LAYOUT ======== */
.app{min-height:100svh;display:grid;grid-template-rows:auto 1fr auto}
.top{position:sticky;top:0;z-index:50;display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;
  padding:12px max(16px,env(safe-area-inset-left)) 8px max(16px,env(safe-area-inset-right));
  background:color-mix(in oklab,var(--surface) 92%, transparent);border-bottom:1px solid var(--line);backdrop-filter:blur(12px)}
.brand{display:flex;align-items:center;gap:10px}
.badge{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--a),var(--b))}
.word{font-weight:900;letter-spacing:.02em}
.status{justify-self:center;color:var(--muted);font-size:12px;display:flex;align-items:center;gap:8px}
.status .dot{width:8px;height:8px;border-radius:50%;background:#8ba}
.status[data-online="true"] .dot{background:var(--ok)}
.theme-toggle{width:36px;height:36px;border:1px solid var(--line);border-radius:12px;display:grid;place-items:center;background:var(--pill);cursor:pointer}
.icon-moon{display:none}
[data-theme="dark"] .icon-sun{display:none}
[data-theme="dark"] .icon-moon{display:block}

.back{position:absolute;left:max(10px,env(safe-area-inset-left));top:12px;width:36px;height:36px;border-radius:12px;display:none;
  place-items:center;border:1px solid var(--line);background:var(--pill);cursor:pointer;z-index:60}
body[data-can-back="true"] .back{display:grid}

.main{height:calc(100svh - 60px - 64px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  padding:clamp(10px,2.5vh,20px) max(16px,env(safe-area-inset-left)) clamp(12px,2.5vh,22px) max(16px,env(safe-area-inset-right));
  overflow:auto}
.view{display:none;animation:fade .14s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
#tab-home:checked ~ .app .view[data-tab="home"],
#tab-clients:checked ~ .app .view[data-tab="clients"],
#tab-farm:checked ~ .app .view[data-tab="farm"],
#tab-accounts:checked ~ .app .view[data-tab="accounts"]{display:block}

/* ======== NAV ======== */
.nav{position:sticky;bottom:0;z-index:45;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
  padding:8px max(14px,env(safe-area-inset-left)) calc(8px + env(safe-area-inset-bottom)) max(14px,env(safe-area-inset-right));
  background:color-mix(in oklab,var(--surface) 92%, transparent);border-top:1px solid var(--line);backdrop-filter:blur(12px)}
.tab{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;border-radius:12px;color:var(--muted);border:1px solid transparent;cursor:pointer}
.tab svg{width:18px;height:18px}
.tab small{font-size:11px}
input[name="tab"]{position:absolute;opacity:0;pointer-events:none}
#tab-home:checked ~ .app .nav label[for="tab-home"],
#tab-clients:checked ~ .app .nav label[for="tab-clients"],
#tab-farm:checked ~ .app .nav label[for="tab-farm"],
#tab-accounts:checked ~ .app .nav label[for="tab-accounts"]{color:var(--text);background:var(--pill);border-color:var(--line)}

/* ======== HOME ======== */
.wrap{max-width:980px;margin:0 auto}
.hero{display:grid;grid-template-columns:1fr auto;align-items:center;gap:clamp(12px,3vw,24px);padding-bottom:8px}
.hero-txt h1{font-size:clamp(24px,4.8vw,32px);font-weight:900;margin-bottom:4px}
.hero-txt p{color:var(--muted)}
/* Orb vivo */
.orb{position:relative;width:clamp(160px,30vw,220px);height:clamp(160px,30vw,220px);filter:drop-shadow(0 16px 40px rgba(124,92,255,.26)) drop-shadow(0 10px 24px rgba(0,211,194,.22))}
.orb .core{position:absolute;inset:14px;border-radius:50%;
  background:radial-gradient(65% 65% at 35% 30%, rgba(124,92,255,.95), rgba(0,211,194,.9) 55%, rgba(255,255,255,0) 70%),
             radial-gradient(90% 90% at 70% 70%, rgba(0,211,194,.55), rgba(124,92,255,.75) 60%, transparent 70%);
  box-shadow:inset 0 0 32px rgba(255,255,255,.22), inset 0 0 60px rgba(124,92,255,.22)}
.orb .glow{position:absolute;inset:-10px;border-radius:50%;filter:blur(18px);
  background:radial-gradient(closest-side, rgba(124,92,255,.4), transparent 70%)}
.orb .ring{position:absolute;inset:0;border-radius:50%;
  background:conic-gradient(from 0deg, rgba(124,92,255,0), rgba(124,92,255,.75), rgba(0,211,194,.6), rgba(124,92,255,0) 70%);
  -webkit-mask: radial-gradient(circle, transparent 68%, #000 69%, #000 82%, transparent 83%);
          mask: radial-gradient(circle, transparent 68%, #000 69%, #000 82%, transparent 83%);
  animation:spin 8s linear infinite}
.spark{position:absolute;left:50%;top:50%;width:6px;height:6px;margin:-3px;border-radius:50%;background:radial-gradient(circle,#fff,rgba(255,255,255,.08));box-shadow:0 0 10px #fff;animation:orbit 7s linear infinite}
.spark.s2{width:5px;height:5px;animation-duration:10s;opacity:.8}
.spark.s3{width:4px;height:4px;animation-duration:12s;opacity:.65}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes orbit{0%{transform:rotate(0) translateX(86px) rotate(0)}100%{transform:rotate(360deg) translateX(86px) rotate(-360deg)}}

/* Pills de redes */
.section-title{font-weight:900;margin:12px 0 10px}
.pills{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
.pill{display:flex;align-items:center;gap:10px;padding:14px;border-radius:14px;background:var(--pill);border:1px solid var(--line);cursor:pointer;box-shadow:var(--shadow);min-height:52px}
.pill .logo{width:22px;height:22px;display:grid;place-items:center}
.pill strong{font-weight:800}

/* Stack interno */
.stack{position:relative;margin-top:8px}
.panel{display:none}
.panel.active{display:block}
.serv-list{display:grid;gap:10px}
.item{display:flex;align-items:center;justify-content:space-between;padding:12px;border:1px solid var(--line);border-radius:14px;background:var(--surface);box-shadow:var(--shadow);cursor:pointer}
.left{display:flex;align-items:center;gap:10px}
.ico{width:36px;height:36px;display:grid;place-items:center;border-radius:10px;background:var(--pill);border:1px solid var(--line)}
.arrow{opacity:.6}

/* Clientes */
.clients{display:grid;gap:10px}
.client{display:flex;align-items:center;justify-content:space-between;background:var(--pill);border:1px solid var(--line);border-radius:14px;padding:10px 12px}
.client .id{display:flex;align-items:center;gap:12px}
.pf{width:40px;height:40px;border-radius:999px;display:grid;place-items:center;overflow:hidden;border:1px solid var(--line);background:linear-gradient(135deg,#ff9a7b22,#e1306c22)}
.pf img{width:100%;height:100%;object-fit:cover}
.pf svg{width:22px;height:22px;color:#E1306C}
.handle{font-weight:800;display:inline-flex;align-items:center;gap:6px}
.verify{width:18px;height:18px;display:inline-block;vertical-align:middle}

/* Quick box */
.quick{position:sticky;bottom:0;margin-top:16px;background:linear-gradient(180deg,transparent,var(--bg) 60%);padding-top:12px}
.input{display:flex;align-items:center;gap:10px;border:1px solid var(--line);background:var(--surface);border-radius:14px;padding:10px;box-shadow:var(--shadow)}
.input input{flex:1;background:transparent;border:0;outline:none;color:var(--text)}
.btn{border:1px solid var(--line);background:linear-gradient(135deg,var(--a),var(--b));color:#0b0d13;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}

/* CLIENTES TAB */
.clients-tab .client{background:var(--surface)}

/* FARM */
.farm-bar{display:flex;align-items:center;justify-content:space-between;margin:6px 0 10px;color:var(--muted)}
.farm{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.card{background:var(--surface);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
.dev{display:grid;gap:10px;padding:12px}
.dev-head{display:flex;align-items:center;justify-content:space-between}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{padding:5px 8px;border:1px solid var(--line);border-radius:999px;background:var(--pill);font-size:12px}
.chip[data-live="true"]{background:#22c55e1a;border-color:#22c55e;color:#22c55e}
.screen{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#000;height:220px;position:relative}
.screen .placeholder{position:absolute;inset:0;background:
  radial-gradient(120% 80% at 10% 10%, rgba(124,92,255,.25), transparent 60%),
  radial-gradient(120% 80% at 90% 90%, rgba(0,211,194,.18), transparent 60%), #000}
.screen iframe,.screen video,.screen img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.toolbar{position:absolute;right:6px;bottom:6px;display:flex;gap:6px}
.tool{border:1px solid rgba(255,255,255,.25);background:rgba(0,0,0,.42);color:#fff;padding:6px 8px;border-radius:10px;font-size:12px}

/* CREDIT */
.credit{position:fixed;right:max(12px,env(safe-area-inset-right));bottom:calc(64px + env(safe-area-inset-bottom) + 10px);z-index:60;
  background:var(--surface);border:1px solid var(--line);border-radius:999px;padding:8px 14px;font-weight:700}
.credit::before{content:"";position:absolute;inset:-2px;border-radius:inherit;background:linear-gradient(135deg,var(--a),var(--b));filter:blur(14px);opacity:.55;z-index:-1;animation:breath 3.2s ease-in-out infinite}
@keyframes breath{0%,100%{opacity:.35;transform:scale(.98)}50%{opacity:.9;transform:scale(1.03)}}
</style>
</head>
<body>
<!-- TABS -->
<input type="radio" name="tab" id="tab-home" checked>
<input type="radio" name="tab" id="tab-clients">
<input type="radio" name="tab" id="tab-farm">
<input type="radio" name="tab" id="tab-accounts">

<!-- SPRITE (logos + iconos) -->
<svg width="0" height="0" aria-hidden="true" style="position:absolute">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7c5cff"/><stop offset="100%" stop-color="#00d3c2"/></linearGradient>
    <symbol id="klogo" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="url(#g)" opacity=".14"/><path d="M18 14h10v16l16-16h12L40 30l16 20H44L28 36v14H18V14z" fill="url(#g)"/></symbol>
    <!-- nav -->
    <symbol id="ico-home" viewBox="0 0 24 24"><path d="M3 10l9-7 9 7v9a2 2 0 0 1-2 2h-4v-7H9v7H5a2 2 0 0 1-2-2z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-users" viewBox="0 0 24 24"><path d="M7 14a4 4 0 1 1 4-4M3 21a6 6 0 0 1 12 0M17 11a3 3 0 1 1 6 0M15 21a6 6 0 0 1 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
    <symbol id="ico-devices" viewBox="0 0 24 24"><rect x="3" y="4" width="14" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><rect x="19" y="8" width="2" height="8" rx="1" fill="currentColor"/></symbol>
    <symbol id="ico-lock" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="9" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M7 11V8a5 5 0 0 1 10 0v3" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-back" viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
    <symbol id="ico-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-moon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.4 5.4 0 0 1-4.4 2.26 5.4 5.4 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <!-- verified IG -->
    <symbol id="ig-verified" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#0095F6"/><path d="M8.8 12.2l2.2 2.2 5-5" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
    <!-- logos oficiales -->
    <symbol id="logo-instagram" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5" fill="none" stroke="#E1306C" stroke-width="2"/><circle cx="12" cy="12" r="4" fill="none" stroke="#E1306C" stroke-width="2"/><circle cx="17.2" cy="6.8" r="1.2" fill="#E1306C"/></symbol>
    <symbol id="logo-tiktok" viewBox="0 0 24 24"><path d="M10 4v9.2a3.8 3.8 0 1 1-2.8 6.2" fill="none" stroke="#69C9D0" stroke-width="2"/><path d="M14 4c.5 2.3 2.2 4 5 4" fill="none" stroke="#ff0050" stroke-width="2"/></symbol>
    <symbol id="logo-youtube" viewBox="0 0 24 24"><rect x="3" y="6" width="18" height="12" rx="3" fill="#FF0000"/><path d="M10 9l6 3-6 3z" fill="#fff"/></symbol>
    <symbol id="logo-x" viewBox="0 0 24 24"><path d="M4 4l16 16M20 4L4 20" stroke="#fff" stroke-width="2"/></symbol>
    <symbol id="logo-facebook" viewBox="0 0 24 24"><path d="M14 8h3V5h-3c-2 0-3 .9-3 3v2H8v3h3v6h3v-6h3l1-3h-4V8c0-.7.3-1 1-1z" fill="#1877F2"/></symbol>
    <symbol id="logo-linkedin" viewBox="0 0 24 24"><rect x="3" y="8" width="4" height="12" fill="#0A66C2"/><circle cx="5" cy="5.5" r="2" fill="#0A66C2"/><rect x="9" y="8" width="12" height="12" rx="2" fill="none" stroke="#0A66C2" stroke-width="2"/></symbol>
    <symbol id="logo-telegram" viewBox="0 0 24 24"><path d="M21 3L3 11l6 2 2 6 3-4 4-10z" fill="#0088cc"/></symbol>
    <symbol id="logo-whatsapp" viewBox="0 0 24 24"><path d="M12 3a9 9 0 0 1 0 18 9.4 9.4 0 0 1-4-.9L5 21l.9-3.1A9.4 9.4 0 0 1 3 12 9 9 0 0 1 12 3z" fill="#25D366"/><path d="M9 8c0 3 3 6 5 6l1-1" stroke="#fff" stroke-width="2"/></symbol>
    <symbol id="logo-discord" viewBox="0 0 24 24"><path d="M7 6c3-1 7-1 10 0 1 2 2 4 2 6-1 2-3 3-5 4l-2-1-2 1c-2-1-4-2-5-4 0-2 1-4 2-6z" fill="#5865F2"/></symbol>
    <symbol id="logo-reddit" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="#FF4500"/><circle cx="9" cy="12" r="1.5" fill="#fff"/><circle cx="15" cy="12" r="1.5" fill="#fff"/><path d="M8 14c1 1 3 2 4 2s3-1 4-2" stroke="#fff" stroke-width="2" fill="none"/></symbol>
    <symbol id="logo-spotify" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#1DB954"/><path d="M7 10c3-1 7-1 10 1M7 13c3-1 6-1 9 1M7 16c2-.5 4-.5 6 .5" stroke="#fff" stroke-width="2" fill="none"/></symbol>
    <symbol id="logo-pinterest" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#E60023"/><path d="M12 6c3 0 5 2 5 4.5S15 15 12.5 15c-1 0-1.7-.5-2-.8l-.7 2.8-.8-.3 1-3.5c-.2-.6-.3-1.2-.3-1.9C9.7 9 10.6 6 12 6z" fill="#fff"/></symbol>
    <symbol id="logo-snapchat" viewBox="0 0 24 24"><path d="M6 10c0-4 3-6 6-6s6 2 6 6c0 2-.8 3.6-2 4.8 1 .6 2 .8 2 1.2 0 .8-3 1-6 1s-6-.2-6-1c0-.4 1-.6 2-1.2C6.8 13.6 6 12 6 10z" fill="#FFFC00" stroke="#000"/></symbol>
    <symbol id="logo-twitch" viewBox="0 0 24 24"><path d="M4 4h16v10l-4 4H12l-2 2H8v-2H4z" fill="#9146FF"/></symbol>
    <symbol id="logo-threads" viewBox="0 0 24 24"><path d="M6 12c0-4 3-7 6-7s6 3 6 7-3 7-6 7c-2 0-3.5-1-3.5-2.5S9 14 12 14c2.5 0 3.8-1.2 3.8-3S14.5 8 12 8" fill="none" stroke="#111" stroke-width="2"/></symbol>
  </defs>
</svg>

<div class="app" id="app">
  <button class="back" id="back-btn" title="Volver"><svg><use href="#ico-back"/></svg></button>
  <header class="top">
    <div class="brand"><div class="badge"><svg width="20" height="20"><use href="#klogo"/></svg></div><div class="word">KraveAI</div></div>
    <div class="status" id="status"><span class="dot"></span><span id="status-text">Conectando…</span></div>
    <button class="theme-toggle" id="theme-toggle"><svg class="icon-sun" width="20" height="20"><use href="#ico-sun"/></svg><svg class="icon-moon" width="20" height="20"><use href="#ico-moon"/></svg></button>
  </header>

  <main class="main">
    <!-- HOME -->
    <section class="view" data-tab="home">
      <div class="wrap">
        <div class="hero">
          <div class="hero-txt">
            <h1>Redes sociales</h1>
            <p>Domina todas tus redes con IA</p>
          </div>
          <div class="orb" aria-hidden="true">
            <div class="glow"></div>
            <div class="core"></div>
            <div class="ring"></div>
            <div class="spark"></div><div class="spark s2"></div><div class="spark s3"></div>
          </div>
        </div>

        <div class="section-title">Redes sociales</div>
        <div class="pills" id="pills"></div>

        <div class="stack" id="stack">
          <div class="panel active" data-panel="root"></div>
          <div class="panel" data-panel="net">
            <div class="section-title" id="net-title">Servicios</div>
            <div class="serv-list" id="serv-list"></div>
          </div>
          <div class="panel" data-panel="svc">
            <div class="section-title" id="svc-title">Servicio</div>
            <div id="svc-body"></div>
          </div>
        </div>

        <div class="section-title" style="margin-top:14px">Clientes recientes</div>
        <div class="clients" id="clients-home"></div>

        <div class="quick">
          <div class="input">
            <span>➕</span><input id="quick-input" placeholder="¿Qué quieres automatizar hoy?"><button class="btn" id="quick-run">Enviar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CLIENTES TAB -->
    <section class="view clients-tab" data-tab="clients">
      <div class="wrap">
        <div class="section-title">Clientes recientes</div>
        <div class="clients" id="clients-tab" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- FARM -->
    <section class="view" data-tab="farm">
      <div class="wrap">
        <div class="section-title">Device Farm</div>
        <div class="farm-bar">
          <label><input type="checkbox" id="dense"> Vista densa</label>
          <small>Streams: HLS .m3u8, MJPEG .mjpg o visor http</small>
        </div>
        <div class="farm" id="farm-grid"></div>
      </div>
    </section>

    <!-- ACCOUNTS -->
    <section class="view" data-tab="accounts">
      <div class="wrap">
        <div class="section-title">Cuentas</div>
        <div class="card" style="padding:12px;margin-top:8px">
          <div class="form">
            <div id="session-sub" style="color:var(--muted)">Verificando…</div>
            <div class="input-row">
              <div class="field"><span>@</span><input id="login-username" placeholder="Usuario"></div>
              <div class="field"><span>🔒</span><input id="login-password" type="password" placeholder="Contraseña"></div>
            </div>
            <div class="input-row">
              <button class="btn" id="login-btn">Iniciar sesión</button>
              <button class="btn" style="background:var(--pill);color:var(--text)" id="logout-btn">Cerrar sesión</button>
            </div>
          </div>
        </div>
        <div class="card" style="padding:12px;margin-top:12px">
          <div class="form">
            <div style="font-weight:800">Agregar cuenta manual</div>
            <div class="input-row">
              <div class="field"><span>@</span><input id="manual-username" placeholder="@usuario"></div>
              <div class="field"><span>🔒</span><input id="manual-password" type="password" placeholder="••••••••"></div>
            </div>
            <button class="btn" id="add-account-btn">Guardar cuenta</button>
          </div>
        </div>
        <div class="card" style="padding:12px;margin-top:12px">
          <div style="font-weight:800;margin-bottom:8px">Cuentas activas</div>
          <div id="accounts-list" class="clients"><div style="color:var(--muted)">Cargando…</div></div>
        </div>
      </div>
    </section>
  </main>

  <nav class="nav" id="nav">
    <label class="tab" for="tab-home"><svg><use href="#ico-home"/></svg><small>Inicio</small></label>
    <label class="tab" for="tab-clients"><svg><use href="#ico-users"/></svg><small>Clientes</small></label>
    <label class="tab" for="tab-farm"><svg><use href="#ico-devices"/></svg><small>Farm</small></label>
    <label class="tab" for="tab-accounts"><svg><use href="#ico-lock"/></svg><small>Cuentas</small></label>
  </nav>
</div>

<div class="credit" id="credit">Created by Karmean Gómez</div>

<script>
(function(){
  const API_URL="https://api.kraveapi.xyz";

  // Tema
  document.getElementById('theme-toggle').addEventListener('click',()=>{
    const cur=document.documentElement.getAttribute('data-theme');
    const next=cur==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
  });

  // Estado real
  const status=document.getElementById('status'), statusText=document.getElementById('status-text');
  async function checkHealth(){
    try{ const r=await fetch(`${API_URL}/health`,{credentials:'include'});
      if(r.ok){ status.setAttribute('data-online','true'); statusText.textContent='Conectado';}
      else throw new Error();
    }catch{ status.removeAttribute('data-online'); statusText.textContent='Sin conexión'; }
  } checkHealth(); setInterval(checkHealth,120000);

  // Quick
  document.getElementById('quick-run').addEventListener('click',()=>{
    const v=(document.getElementById('quick-input').value||'').trim();
    if(!v) return alert('Escribe qué automatizar');
    alert('Automatizando: '+v);
  });

  // Redes (todas con logo oficial)
  const NETWORKS={
    instagram:{label:'Instagram',logo:'#logo-instagram',color:'#E1306C',services:[{key:'comentarios',label:'Comentarios',form:true},{key:'likes',label:'Likes'},{key:'seguidores',label:'Seguidores'},{key:'vistas',label:'Vistas'}]},
    tiktok:{label:'TikTok',logo:'#logo-tiktok',color:'#69C9D0',services:[{key:'vistas',label:'Vistas'},{key:'likes',label:'Likes'},{key:'seguidores',label:'Seguidores'}]},
    youtube:{label:'YouTube',logo:'#logo-youtube',color:'#FF0000',services:[{key:'vistas',label:'Vistas'},{key:'likes',label:'Likes'},{key:'suscripciones',label:'Suscripciones'}]},
    x:{label:'X',logo:'#logo-x',color:'#fff',services:[{key:'likes',label:'Likes'},{key:'reposts',label:'Reposts'},{key:'seguidores',label:'Seguidores'}]},
    facebook:{label:'Facebook',logo:'#logo-facebook',color:'#1877F2',services:[{key:'reacciones',label:'Reacciones'},{key:'comentarios',label:'Comentarios'}]},
    linkedin:{label:'LinkedIn',logo:'#logo-linkedin',color:'#0A66C2',services:[{key:'reacciones',label:'Reacciones'},{key:'comentarios',label:'Comentarios'},{key:'conexiones',label:'Conexiones'}]},
    whatsapp:{label:'WhatsApp',logo:'#logo-whatsapp',color:'#25D366',services:[{key:'mensajes',label:'Mensajes'}]},
    telegram:{label:'Telegram',logo:'#logo-telegram',color:'#0088cc',services:[{key:'mensajes',label:'Mensajes'},{key:'miembros',label:'Miembros'}]},
    discord:{label:'Discord',logo:'#logo-discord',color:'#5865F2',services:[{key:'mensajes',label:'Mensajes'},{key:'invitaciones',label:'Invitaciones'}]},
    reddit:{label:'Reddit',logo:'#logo-reddit',color:'#FF4500',services:[{key:'upvotes',label:'Upvotes'},{key:'comentarios',label:'Comentarios'}]},
    spotify:{label:'Spotify',logo:'#logo-spotify',color:'#1DB954',services:[{key:'streams',label:'Streams'},{key:'saves',label:'Saves'}]},
    pinterest:{label:'Pinterest',logo:'#logo-pinterest',color:'#E60023',services:[{key:'repins',label:'Repins'},{key:'saves',label:'Saves'}]},
    snapchat:{label:'Snapchat',logo:'#logo-snapchat',color:'#FFFC00',services:[{key:'vistas',label:'Vistas'}]},
    twitch:{label:'Twitch',logo:'#logo-twitch',color:'#9146FF',services:[{key:'viewers',label:'Viewers'},{key:'chat',label:'Chat'}]},
    threads:{label:'Threads',logo:'#logo-threads',color:'#111',services:[{key:'likes',label:'Likes'},{key:'respuestas',label:'Respuestas'}]},
  };

  // Render pills auto-fit para ocupar pantalla
  const pills = document.getElementById('pills');
  pills.innerHTML = Object.entries(NETWORKS).map(([k,v]) => `
    <button class="pill" data-net="${k}">
      <span class="logo" style="color:${v.color}"><svg><use href="${v.logo}"/></svg></span>
      <strong>${v.label}</strong>
    </button>`).join('');

  // Stack Home → Net → Svc
  const stack=document.getElementById('stack');
  const panels={
    root:stack.querySelector('[data-panel="root"]'),
    net:stack.querySelector('[data-panel="net"]'),
    svc:stack.querySelector('[data-panel="svc"]'),
  };
  const netTitle=document.getElementById('net-title'), servList=document.getElementById('serv-list');
  const svcTitle=document.getElementById('svc-title'), svcBody=document.getElementById('svc-body');
  let navStack=['root'];

  function showPanel(name){
    stack.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    panels[name].classList.add('active');
    document.body.toggleAttribute('data-can-back', navStack.length>1);
  }

  pills.addEventListener('click',e=>{
    const b=e.target.closest('.pill'); if(!b) return;
    const net=NETWORKS[b.dataset.net]; if(!net) return;
    netTitle.textContent=net.label;
    servList.innerHTML=net.services.map(s=>`
      <div class="item" data-net="${b.dataset.net}" data-svc="${s.key}">
        <div class="left"><div class="ico"><svg width="20" height="20"><use href="${net.logo}"/></svg></div><div style="font-weight:800">${s.label}</div></div>
        <div class="arrow">›</div>
      </div>`).join('');
    navStack.push('net'); showPanel('net');
  });

  servList.addEventListener('click', e=>{
    const it=e.target.closest('.item'); if(!it) return;
    const net=NETWORKS[it.dataset.net]; const svc=net?.services.find(x=>x.key===it.dataset.svc); if(!svc) return;
    svcTitle.textContent=`${net.label} — ${svc.label}`;
    if(net===NETWORKS.instagram && svc.key==='comentarios'){
      svcBody.innerHTML=`
      <div class="card" style="padding:12px">
        <div class="form">
          <div class="field"><span>🔗</span><input id="ig-url" placeholder="URL del post (https://www.instagram.com/p/...)"></div>
          <div class="input-row">
            <div class="field"><span>#</span><input id="ig-cantidad" type="number" min="1" max="100" value="30"></div>
            <div class="field"><span>🎛️</span><input id="ig-modo" value="auto" list="modos"></div>
          </div>
          <datalist id="modos"><option value="auto"><option value="personalizado"><option value="manual"></datalist>
          <div class="input-row"><div class="field"><span>🧑‍💼</span><input id="ig-apodo" placeholder="Apodo (opcional)"></div><div class="field"><span>🎯</span><input id="ig-estilo" placeholder="Estilo"></div></div>
          <div class="field"><span>🏷️</span><input id="ig-actividad" placeholder="Actividad"></div>
          <div class="field"><span>📝</span><input id="ig-ejemplos" placeholder="Ejemplos (uno por línea)"></div>
          <div class="input-row"><button class="btn" id="ig-send">Lanzar</button><button class="btn" style="background:var(--pill);color:var(--text)" id="ig-cancel">Cancelar</button></div>
          <div class="hint" id="ig-status">—</div>
        </div>
      </div>`;
      setTimeout(()=>{
        const st=()=>document.getElementById('ig-status');
        document.getElementById('ig-send').addEventListener('click', async ()=>{
          const payload={
            url:document.getElementById('ig-url').value.trim(),
            cantidad:document.getElementById('ig-cantidad').value.trim(),
            modo:document.getElementById('ig-modo').value.trim(),
            apodo:document.getElementById('ig-apodo').value.trim(),
            estilo:document.getElementById('ig-estilo').value.trim(),
            actividad:document.getElementById('ig-actividad').value.trim(),
            ejemplos:document.getElementById('ig-ejemplos').value.trim(),
          };
          if(!payload.url){ st().textContent='❌ Falta URL'; return; }
          try{
            st().textContent='Enviando…';
            const r=await fetch(`${API_URL}/instagram/comentarios`,{
              method:'POST',headers:{'Content-Type':'application/json'},
              credentials:'include',body:JSON.stringify(payload)});
            const d=await r.json().catch(()=>({}));
            if(r.ok){ st().textContent='✅ Comentarios en proceso'; } else { throw new Error(d.mensaje||'Error en comentarios'); }
          }catch(err){ st().textContent='❌ '+err.message; }
        });
        document.getElementById('ig-cancel').addEventListener('click',()=>{ st().textContent='—'; });
      },0);
    }else{
      svcBody.innerHTML=`<div class="card" style="padding:12px">
        <div class="hint">Interfaz lista para conectar a <strong>${net.label} → ${svc.label}</strong>.</div>
        <div class="form" style="margin-top:8px">
          <div class="field"><span>🔗</span><input placeholder="URL / identificador"></div>
          <div class="input-row"><div class="field"><span>#</span><input type="number" min="1" placeholder="Cantidad"></div><button class="btn">Enviar</button></div>
        </div></div>`;
    }
    navStack.push('svc'); showPanel('svc');
  });

  // Back + swipe-back
  function goBack(){ if(navStack.length>1){ navStack.pop(); showPanel(navStack.at(-1)); } }
  document.getElementById('back-btn').addEventListener('click', goBack);
  let sx=null, sy=null, tracking=false;
  addEventListener('pointerdown',(e)=>{ if(e.clientX<24){ sx=e.clientX; sy=e.clientY; tracking=true; }});
  addEventListener('pointermove',(e)=>{ if(!tracking) return; const dx=e.clientX-sx, dy=Math.abs(e.clientY-sy); if(dx>70&&dy<40){tracking=false;goBack();} if(dx<-10||dy>48) tracking=false; });
  addEventListener('pointerup',()=>tracking=false);
  document.querySelectorAll('input[name="tab"]').forEach(r=> r.addEventListener('change', ()=>{
    if(document.getElementById('tab-home').checked){ navStack=['root']; showPanel('root'); }
  }));

  // Clientes (solo 4, sin logo duplicado)
  const CLIENTS=[ '@aaronmercury','@televisadigital','@joscanela','@jimenagallegotv' ];
  function renderClients(id){
    const root=document.getElementById(id);
    root.innerHTML = CLIENTS.map(h=>`
      <div class="client">
        <div class="id">
          <div class="pf"><svg><use href="#logo-instagram"/></svg></div>
          <div>
            <div class="handle">${h} <svg class="verify"><use href="#ig-verified"/></svg></div>
            <small style="color:var(--muted)">Instagram</small>
          </div>
        </div>
      </div>`).join('');
  }
  renderClients('clients-home'); renderClients('clients-tab');

  // Accounts
  const sessionSub=document.getElementById('session-sub');
  async function checkSession(){
    try{ const r=await fetch(`${API_URL}/estado-sesion`,{credentials:'include'}); const d=await r.json();
      sessionSub.textContent=(d.status==='activo')?`Sesión activa como @${d.usuario}`:'No hay sesión activa';
    }catch{ sessionSub.textContent='Error al verificar sesión'; }
  } checkSession();

  document.getElementById('login-btn').addEventListener('click', async ()=>{
    const u=document.getElementById('login-username').value.trim().replace('@','');
    const p=document.getElementById('login-password').value.trim();
    if(!u||!p){ sessionSub.textContent='Completa usuario y contraseña'; return; }
    try{
      const r=await fetch(`${API_URL}/iniciar-sesion`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:u,contrasena:p})});
      const d=await r.json(); if(d.exito){ sessionSub.textContent=`Sesión activa como @${d.usuario}`; } else throw new Error(d.mensaje||'Error al iniciar');
    }catch(err){ sessionSub.textContent=err.message; }
  });
  document.getElementById('logout-btn').addEventListener('click', async ()=>{
    try{ const r=await fetch(`${API_URL}/cerrar-sesion`,{credentials:'include'}); const d=await r.json();
      sessionSub.textContent=d.exito?'No hay sesión activa':(d.mensaje||'Error al cerrar'); }
    }catch(err){ sessionSub.textContent=err.message; }
  });

  const accountsList=document.getElementById('accounts-list');
  async function loadAccounts(){
    try{ const r=await fetch(`${API_URL}/cuentas-activas`,{credentials:'include'}); const arr=await r.json();
      if(!Array.isArray(arr)||arr.length===0){accountsList.innerHTML='<div style="color:var(--muted)">No hay cuentas activas</div>';return}
      accountsList.innerHTML=arr.map(acc=>`
        <div class="client">
          <div class="id"><div class="handle">@${acc.username}</div></div>
          <div class="chips">
            ${acc.status==='activo'
              ? `<button class="chip" data-logout="${acc.username}">Logout</button>`
              : `<button class="chip" data-login="${acc.username}">Login</button>`}
          </div>
        </div>`).join('');
    }catch{ accountsList.innerHTML='<div style="color:var(--muted)">Error al cargar cuentas</div>'; }
  }
  loadAccounts(); setInterval(loadAccounts, 30000);
  accountsList.addEventListener('click', async (e)=>{
    const b=e.target.closest('button'); if(!b) return;
    if(b.dataset.login){ await fetch(`${API_URL}/iniciar-sesion-cuenta`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:b.dataset.login})}); loadAccounts(); }
    if(b.dataset.logout){ await fetch(`${API_URL}/cerrar-sesion-cuenta`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:b.dataset.logout})}); loadAccounts(); }
  });

  // FARM
  const defaultDevices=[
    {id:'dev1',name:'iPhone 14 Pro',os:'iOS',ip:'10.0.0.8'},
    {id:'dev2',name:'Galaxy S23',os:'Android',ip:'10.0.0.9'},
    {id:'dev3',name:'iPhone 13',os:'iOS',ip:'10.0.0.10'},
    {id:'dev4',name:'Pixel 8',os:'Android',ip:'10.0.0.11'}
  ];
  const farmGrid=document.getElementById('farm-grid');
  document.getElementById('dense').addEventListener('change',e=>{
    farmGrid.style.gridTemplateColumns=e.target.checked?'repeat(auto-fit,minmax(200px,1fr))':'repeat(auto-fit,minmax(260px,1fr))';
  });
  function renderFarm(){
    farmGrid.innerHTML=defaultDevices.map(d=>{
      const src=localStorage.getItem('stream:'+d.id)||''; const live=!!src;
      return `<div class="card dev" data-id="${d.id}">
        <div class="dev-head">
          <div><strong>${d.name}</strong> · ${d.os}</div>
          <div class="chips"><span class="chip">${d.ip}</span><span class="chip" data-live="${live}">${live?'Live':'Idle'}</span></div>
        </div>
        <div class="screen" data-screen>${live?'':'<div class="placeholder"></div>'}
          <div class="toolbar">
            <button class="tool" data-set="${d.id}">Stream</button>
            <button class="tool" data-toggle="${d.id}">Pausa</button>
            <button class="tool" data-full="${d.id}">Full</button>
            <button class="tool" data-clear="${d.id}">Clear</button>
          </div>
        </div>
      </div>`;
    }).join(''); mountStreams();
  }
  function mountStreams(){
    farmGrid.querySelectorAll('.dev').forEach(card=>{
      const id=card.dataset.id; const src=localStorage.getItem('stream:'+id)||''; const screen=card.querySelector('[data-screen]');
      if(!src) return;
      if(src.endsWith('.mjpg')||src.endsWith('.mjpeg')){ const img=document.createElement('img'); img.src=src; screen.appendChild(img); }
      else if(src.endsWith('.m3u8')){ const v=document.createElement('video'); v.src=src; v.autoplay=true; v.muted=true; v.playsInline=true; screen.appendChild(v); }
      else { const f=document.createElement('iframe'); f.src=src; f.allow='autoplay; encrypted-media'; f.allowFullscreen=true; f.loading='lazy'; screen.appendChild(f); }
    });
  }
  farmGrid.addEventListener('click',(e)=>{
    const el=e.target.closest('button.tool'); if(!el) return;
    const id=el.dataset.set||el.dataset.toggle||el.dataset.full||el.dataset.clear;
    const card=e.target.closest('.dev'); const screen=card.querySelector('[data-screen]');
    if(el.dataset.set){ const cur=localStorage.getItem('stream:'+id)||''; const url=prompt('URL stream (HLS .m3u8, MJPEG .mjpg, o https):',cur); if(url!==null){ localStorage.setItem('stream:'+id,url.trim()); renderFarm(); } }
    if(el.dataset.clear){ localStorage.removeItem('stream:'+id); renderFarm(); }
    if(el.dataset.full){ screen.requestFullscreen?.(); }
    if(el.dataset.toggle){
      const v=screen.querySelector('video'); if(v){ v.paused? v.play(): v.pause(); el.textContent=v.paused?'Reanudar':'Pausa'; }
      const f=screen.querySelector('iframe'); if(f){ f.style.opacity=(f.style.opacity==='0.35'?'1':'0.35'); el.textContent=(f.style.opacity==='0.35')?'Reanudar':'Pausa'; }
    }
  });
  renderFarm();

  // Crédito: mantener sobre nav
  (function positionCredit(){
    const nav=document.getElementById('nav'), credit=document.getElementById('credit');
    const set=()=>credit.style.bottom=`calc(${nav.getBoundingClientRect().height}px + env(safe-area-inset-bottom) + 10px)`;
    set(); addEventListener('resize',set);
  })();
})();
</script>
</body>
</html>