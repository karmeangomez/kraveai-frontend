<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <meta name="theme-color" content="#0b0b10" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="author" content="Karmean GÃ³mez">
  <title>KRAVEAI â€” Automation OS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* ================= Design tokens ================= */
    :root{
      --bg:#0b0b10; --elev:#111218; --card:#141822; --text:#ECEEF4; --muted:#9aa0a6; --line:#24263a;
      --accent:#7C5CFF; --accent2:#00DBC1; --success:#34d399; --warn:#ffb454; --err:#ff5f74;
      --glass:rgba(255,255,255,.06); --glass-2:rgba(255,255,255,.08);
      --r:14px; --shadow:0 12px 40px rgba(0,0,0,.35);
      --igBlue:#0095F6;
      --device-h:230px; --device-min-col:190px;
    }
    :root.light{
      --bg:#f7f8fb; --elev:#ffffff; --card:#ffffff; --text:#0B0D13; --muted:#6b7280; --line:#e6e9f1;
      --glass:rgba(0,0,0,.04); --glass-2:rgba(0,0,0,.06); --shadow:0 10px 28px rgba(0,0,0,.1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:14.5px/1.45 ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, Roboto;
      -webkit-font-smoothing:antialiased;
      overflow:hidden;  /* app-like */
    }

    /* ===== Background aurora */
    .aurora{position:fixed; inset:-15% -25%; z-index:-1; filter:blur(38px); opacity:.42; pointer-events:none;
      background:
       radial-gradient(60% 40% at 85% 10%, rgba(124,92,255,.36), transparent 60%),
       radial-gradient(45% 35% at 10% 0%, rgba(0,219,193,.26), transparent 70%),
       radial-gradient(40% 30% at 15% 85%, rgba(255,95,116,.18), transparent 70%);
      animation:aur 18s ease-in-out infinite alternate}
    @keyframes aur{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(-2%,1%,0)}}

    /* ===== Top bar ===== */
    .topbar{
      position:fixed; top:0; left:0; right:0; z-index:60;
      display:grid; grid-template-columns:auto 1fr auto auto; gap:8px; align-items:center;
      padding: calc(8px + env(safe-area-inset-top)) 12px 8px;
      background: color-mix(in oklab, var(--elev) 92%, transparent);
      border-bottom:1px solid var(--line);
      backdrop-filter:saturate(1.15) blur(16px);
    }
    .brand-mini{ display:flex; align-items:center; gap:8px }
    .wordmark{ font-weight:900; letter-spacing:.16em; font-size:.98rem }
    .chip{
      width:34px;height:34px;border-radius:10px;display:grid;place-items:center;
      background:var(--glass);border:1px solid var(--line); color:var(--muted);
      transition:transform .18s ease;
    }
    .chip:active{ transform:scale(.96) }
    .status{
      justify-self:start; display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      background:var(--glass); border:1px solid var(--line); font-size:.86rem
    }

    /* ===== App shell (compact) ===== */
    .shell{
      position:fixed; left:0; right:0;
      top:calc(48px + env(safe-area-inset-top));
      bottom:calc(62px + env(safe-area-inset-bottom));
      display:grid; grid-template-rows:auto auto 1fr; gap:8px; padding:10px 12px; overflow:hidden;
      max-width:1200px; margin:0 auto;
    }
    .hero{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .logo-badge{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 10px 22px rgba(124,92,255,.32), 0 8px 18px rgba(0,219,193,.18);
    }
    .k-logo{ width:24px; height:24px; filter: drop-shadow(0 2px 8px rgba(124,92,255,.38)); animation:logoPulse 4.2s ease-in-out infinite }
    @keyframes logoPulse {0%{filter:drop-shadow(0 2px 8px rgba(124,92,255,.38))}50%{filter:drop-shadow(0 6px 18px rgba(124,92,255,.6))}100%{filter:drop-shadow(0 2px 8px rgba(124,92,255,.38))}}

    .btn{ border:1px solid var(--line); background:linear-gradient(180deg, color-mix(in oklab, var(--card) 94%, transparent), color-mix(in oklab, var(--card) 100%, transparent));
      color:var(--text); padding:8px 12px; border-radius:12px; font-weight:700; font-size:.9rem; cursor:pointer }
    .btn-primary{ background:linear-gradient(135deg, var(--accent), var(--accent2)); border:0; color:#0b0b10 }

    .tabs{display:flex; gap:6px}
    .tabmini{flex:1; display:flex; align-items:center; justify-content:center; gap:6px;
      padding:8px; border-radius:12px; background:var(--glass); border:1px solid var(--line);
      color:var(--muted); font-weight:700; font-size:.9rem; cursor:pointer}
    .tabmini.active{color:var(--text); background:var(--glass-2)}

    .views{position:relative; overflow:hidden; border-radius:var(--r)}
    .view{position:absolute; inset:0; display:none; overflow:auto; padding:10px}
    .view.active{display:block; animation:fade .18s ease}
    @keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

    /* ===== Cards/tiles ===== */
    .grid{ display:grid; gap:10px; grid-template-columns:repeat(3,minmax(0,1fr)) }
    @media (min-width:700px){ .grid{ grid-template-columns:repeat(5,minmax(0,1fr)) } }
    .card{ background:linear-gradient(180deg, color-mix(in oklab, var(--card) 94%, transparent), color-mix(in oklab, var(--card) 98%, transparent));
      border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow) }
    .tile{ display:flex; align-items:center; gap:10px; padding:12px; cursor:pointer; transition:transform .12s ease }
    .tile:hover{ transform:translateY(-1px) }
    .tile .icon{ width:38px; height:38px; border-radius:12px; display:grid; place-items:center; background:var(--glass-2); border:1px solid var(--line) }
    .tile .label{ font-weight:800; font-size:.98rem }
    .muted{ color:var(--muted) }

    .input-wrap{ display:flex; align-items:center; gap:8px; border:1px solid var(--line); background:var(--glass);
      border-radius:12px; padding:8px 10px }
    .input-wrap input{flex:1; background:transparent; border:0; outline:none; color:var(--text); font-size:.95rem}

    /* ===== Tab bar ===== */
    .tabbar{
      position:fixed; inset-inline:0; bottom:0; z-index:55; display:grid; grid-template-columns:repeat(5,1fr); gap:8px;
      padding:8px 10px calc(8px + env(safe-area-inset-bottom)); background:color-mix(in oklab, var(--elev) 92%, transparent);
      border-top:1px solid var(--line); backdrop-filter:saturate(1.15) blur(16px)
    }
    .tab{display:flex; flex-direction:column; align-items:center; gap:4px; border-radius:12px; padding:6px; color:var(--muted); border:1px solid transparent}
    .tab.active{color:var(--text); background:var(--glass); border-color:var(--line)}
    .tab i{font-size:1rem} .tab span{font-size:.72rem}
    @media (max-width:480px){ .tab span{display:none} }

    /* ===== Panels ===== */
    .panel{ position:fixed; inset:0; z-index:70; display:none }
    .panel.active{ display:block }
    .panel .inner{ position:absolute; left:0; right:0; top:calc(48px + env(safe-area-inset-top)); bottom:calc(62px + env(safe-area-inset-bottom));
      background:var(--bg); padding:10px 12px; overflow:auto; max-width:1200px; margin:0 auto; animation:slide .2s ease }
    @keyframes slide{from{transform:translateX(14px);opacity:0}to{transform:translateX(0);opacity:1}}

    /* ===== Service Center ===== */
    .svc-grid{ display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr)) }
    @media (min-width:820px){ .svc-grid{ grid-template-columns:repeat(3,minmax(0,1fr)) } }
    .svc-card .title{ padding:12px; display:flex; gap:10px; align-items:center; font-weight:900 }
    .svc-card .hint{ padding:0 12px 10px; color:var(--muted); font-size:.85rem }
    .form{ display:grid; gap:8px } .row{ display:grid; gap:6px } .row label{ color:var(--muted); font-size:.85rem }
    .ctrl{ border:1px solid var(--line); background:var(--glass); color:var(--text); border-radius:12px; padding:10px; outline:none }
    textarea.ctrl{ min-height:90px; resize:vertical }

    /* ===== Device Farm ===== */
    .farm-grid{ display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(var(--device-min-col), 1fr)); }
    .device{ display:grid; gap:8px; padding:10px }
    .device-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; font-size:.92rem }
    .chips{ display:flex; gap:6px; flex-wrap:wrap }
    .chip-b{ padding:5px 8px; border:1px solid var(--line); border-radius:999px; background:var(--glass); font-size:.78rem }
    .device-screen{ border:1px solid var(--line); border-radius:14px; overflow:hidden; background:#000; height:var(--device-h); position:relative }
    .device-screen video,.device-screen img{ width:100%; height:100%; object-fit:cover; display:block }
    .device-screen .overlay{ position:absolute; left:6px; top:6px; display:flex; gap:6px }

    /* ===== Accounts list ===== */
    .list{ display:grid; gap:8px } .list-item{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px; border:1px solid var(--line); border-radius:12px; background:var(--glass) }

    /* ===== Toast & Signature ===== */
    .toast{ position:fixed; top:12px; left:50%; transform:translateX(-50%); background:color-mix(in oklab,var(--elev) 96%, transparent);
      border:1px solid var(--line); border-radius:999px; padding:8px 12px; z-index:90; display:none; box-shadow:var(--shadow) }
    .toast.show{ display:block; animation:fade .18s ease }

    .credit{
      position:fixed; right:10px; bottom:calc(66px + env(safe-area-inset-bottom));
      z-index:80; font-size:.86rem; color:var(--text);
      background:linear-gradient(180deg, color-mix(in oklab, var(--elev) 96%, transparent), color-mix(in oklab, var(--elev) 98%, transparent));
      border:1px solid var(--line); border-radius:999px; padding:7px 12px; backdrop-filter:blur(6px);
      box-shadow:0 0 12px rgba(124,92,255,.6), 0 0 22px rgba(0,219,193,.35);
      animation:breathe 4s ease-in-out infinite, glowPulse 2.4s ease-in-out infinite;
    }
    @keyframes breathe{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.04);opacity:.97}}
    @keyframes glowPulse{0%{box-shadow:0 0 10px rgba(124,92,255,.45), 0 0 18px rgba(0,219,193,.28)}
      50%{box-shadow:0 0 18px rgba(124,92,255,.75),0 0 30px rgba(0,219,193,.48)}
      100%{box-shadow:0 0 10px rgba(124,92,255,.45),0 0 18px rgba(0,219,193,.28)}}

    /* ===== IG verified badge (REAL IG style) ===== */
    .ig-badge{ display:inline-flex; width:16px; height:16px; margin-left:6px; vertical-align:middle }
    .clients-grid{ display:grid; gap:8px; grid-template-columns:repeat(2,minmax(0,1fr)); }
    @media (min-width:680px){ .clients-grid{ grid-template-columns:repeat(5,minmax(0,1fr)); } }
    .client{ display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:var(--glass); font-weight:800 }
  </style>
</head>
<body>
  <!-- ===== Sprites: logo + IG verified ===== -->
  <svg width="0" height="0" style="position:absolute" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="g-krave" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#7C5CFF"/><stop offset="100%" stop-color="#00DBC1"/>
      </linearGradient>
      <symbol id="logo-krave" viewBox="0 0 64 64">
        <circle cx="32" cy="32" r="30" fill="url(#g-krave)" opacity="0.14"/>
        <path d="M18 14h10v16l16-16h12L40 30l16 20H44L28 36v14H18V14z" fill="url(#g-krave)"/>
      </symbol>
      <!-- Insignia verificada de Instagram (azul IG con check blanco) -->
      <symbol id="ig-verified" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="11" fill="#0095F6"/>
        <path d="M10.1 14.7 7.7 12.3a1 1 0 1 1 1.4-1.4l1.0 1.0 4.8-4.8a1 1 0 1 1 1.4 1.4l-6.2 6.2a1 1 0 0 1-1.4 0z" fill="#fff"/>
      </symbol>
    </defs>
  </svg>

  <div class="aurora"></div>

  <!-- ===== Topbar ===== -->
  <header class="topbar">
    <div class="brand-mini">
      <svg viewBox="0 0 64 64" class="k-logo"><use href="#logo-krave"/></svg>
      <span class="wordmark">KRAVEAI</span>
    </div>
    <div class="status"><i class="fa-solid fa-circle" style="color:#E34D5A"></i><span id="status-text">Error de conexiÃ³n</span></div>
    <button class="chip" id="notif-btn" title="Notificaciones"><i class="fa-regular fa-bell"></i></button>
    <button class="chip" id="theme-btn" title="Tema"><i class="fa-solid fa-moon"></i></button>
  </header>

  <!-- ===== Shell (inicio) ===== -->
  <div class="shell" id="home-shell">
    <section class="hero">
      <div style="display:flex;align-items:center;gap:10px">
        <div class="logo-badge"><svg viewBox="0 0 64 64" class="k-logo"><use href="#logo-krave"/></svg></div>
        <div>
          <div style="font-weight:900;letter-spacing:.16em">KRAVEAI</div>
          <div class="muted" style="font-size:.85rem">Automation Operating System</div>
        </div>
      </div>
      <button class="btn btn-primary" id="open-farm">Device Farm</button>
    </section>

    <div class="tabs">
      <button class="tabmini active" data-tview="social"><i class="fa-solid fa-hashtag"></i> Redes</button>
      <button class="tabmini" data-tview="automation"><i class="fa-solid fa-bolt"></i> AutomatizaciÃ³n</button>
      <button class="tabmini" data-tview="clients"><i class="fa-solid fa-users"></i> Clientes</button>
    </div>

    <div class="views">
      <!-- Redes -->
      <div class="view active" id="view-social">
        <div class="grid" id="social-grid">
          <!-- 15 redes -->
          <div class="card tile" data-platform="instagram"><div class="icon"><i class="fa-brands fa-instagram" style="color:#E1306C"></i></div><div><div class="label">Instagram</div><small class="muted">Comentarios Â· Likes Â· Views</small></div></div>
          <div class="card tile" data-platform="tiktok"><div class="icon"><i class="fa-brands fa-tiktok" style="color:#69C9D0"></i></div><div><div class="label">TikTok</div><small class="muted">Vistas Â· Likes Â· Follows</small></div></div>
          <div class="card tile" data-platform="youtube"><div class="icon"><i class="fa-brands fa-youtube" style="color:#FF0000"></i></div><div><div class="label">YouTube</div><small class="muted">Vistas Â· Likes Â· Comentarios</small></div></div>
          <div class="card tile" data-platform="threads"><div class="icon"><i class="fa-brands fa-threads" style="color:#fff"></i></div><div><div class="label">Threads</div><small class="muted">Likes Â· Respuestas</small></div></div>
          <div class="card tile" data-platform="x"><div class="icon"><i class="fa-brands fa-x-twitter" style="color:#fff"></i></div><div><div class="label">X</div><small class="muted">Likes Â· Reposts Â· Follows</small></div></div>
          <div class="card tile" data-platform="facebook"><div class="icon"><i class="fa-brands fa-facebook" style="color:#1877F2"></i></div><div><div class="label">Facebook</div><small class="muted">Reacciones Â· Comentarios</small></div></div>
          <div class="card tile" data-platform="linkedin"><div class="icon"><i class="fa-brands fa-linkedin" style="color:#0A66C2"></i></div><div><div class="label">LinkedIn</div><small class="muted">Engagement</small></div></div>
          <div class="card tile" data-platform="snapchat"><div class="icon"><i class="fa-brands fa-snapchat" style="color:#FFFC00"></i></div><div><div class="label">Snapchat</div></div></div>
          <div class="card tile" data-platform="discord"><div class="icon"><i class="fa-brands fa-discord" style="color:#5865F2"></i></div><div><div class="label">Discord</div></div></div>
          <div class="card tile" data-platform="telegram"><div class="icon"><i class="fa-brands fa-telegram" style="color:#0088cc"></i></div><div><div class="label">Telegram</div></div></div>
          <div class="card tile" data-platform="whatsapp"><div class="icon"><i class="fa-brands fa-whatsapp" style="color:#25D366"></i></div><div><div class="label">WhatsApp</div></div></div>
          <div class="card tile" data-platform="twitch"><div class="icon"><i class="fa-brands fa-twitch" style="color:#9146FF"></i></div><div><div class="label">Twitch</div></div></div>
          <div class="card tile" data-platform="reddit"><div class="icon"><i class="fa-brands fa-reddit" style="color:#FF4500"></i></div><div><div class="label">Reddit</div></div></div>
          <div class="card tile" data-platform="spotify"><div class="icon"><i class="fa-brands fa-spotify" style="color:#1DB954"></i></div><div><div class="label">Spotify</div></div></div>
          <div class="card tile" data-platform="pinterest"><div class="icon"><i class="fa-brands fa-pinterest" style="color:#E60023"></i></div><div><div class="label">Pinterest</div></div></div>
        </div>
      </div>

      <!-- AutomatizaciÃ³n -->
      <div class="view" id="view-automation">
        <div class="input-wrap">
          <i class="fa-solid fa-wand-magic-sparkles" style="color:var(--muted)"></i>
          <input id="automation-input" placeholder="Â¿QuÃ© quieres automatizar hoy?">
          <button class="btn btn-primary" id="automation-run"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
        <div class="card tile" style="margin-top:10px"><div class="icon"><i class="fa-solid fa-circle-info"></i></div><div><div class="label">Estado</div><small class="muted">Sin acciones en curso</small></div></div>
      </div>

      <!-- Clientes (con insignia IG real) -->
      <div class="view" id="view-clients">
        <div class="clients-grid">
          <div class="client">@aaronmercury <svg class="ig-badge"><use href="#ig-verified"/></svg></div>
          <div class="client">@televisadigital <svg class="ig-badge"><use href="#ig-verified"/></svg></div>
          <div class="client">@joscanela <svg class="ig-badge"><use href="#ig-verified"/></svg></div>
          <div class="client">@jimenagallegotv <svg class="ig-badge"><use href="#ig-verified"/></svg></div>
          <div class="client">@elmalilla_ <svg class="ig-badge"><use href="#ig-verified"/></svg></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firma (glow sutil) -->
  <div class="credit" id="credit">Created by Karmean GÃ³mez</div>

  <!-- ====== Panels ====== -->

  <!-- Service Center -->
  <div class="panel" id="svc-panel">
    <div class="inner">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="font-weight:900"><i class="fa-solid fa-sparkles"></i> <span id="svc-title">Servicios</span></div>
        <button class="btn" id="svc-back"><i class="fa-solid fa-arrow-left"></i> Volver</button>
      </div>
      <div class="svc-grid" id="svc-grid"></div>

      <div class="card" id="svc-form-card" style="display:none;margin-top:10px;padding:12px">
        <div style="font-weight:900;margin-bottom:6px" id="svc-form-title"><i class="fa-solid fa-sliders"></i> Configurar</div>
        <form class="form" id="svc-form"></form>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn btn-primary" id="svc-run"><i class="fa-solid fa-play"></i> Ejecutar</button>
          <button class="btn" id="svc-cancel">Cancelar</button>
        </div>
        <div id="svc-kpis" style="display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));margin-top:10px"></div>
      </div>
    </div>
  </div>

  <!-- Device Farm -->
  <div class="panel" id="farm-panel">
    <div class="inner">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="font-weight:900"><i class="fa-solid fa-mobile-screen-button"></i> Device Farm</div>
        <div style="display:flex;gap:6px">
          <button class="btn" id="zoom-out">â€“</button>
          <button class="btn" id="zoom-in">+</button>
          <button class="btn" id="farm-back"><i class="fa-solid fa-arrow-left"></i> Volver</button>
        </div>
      </div>
      <div class="farm-grid" id="farm-grid"></div>
    </div>
  </div>

  <!-- Cuentas -->
  <div class="panel" id="accounts-panel">
    <div class="inner">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="font-weight:900"><i class="fa-solid fa-users"></i> Cuentas</div>
        <button class="btn" id="acc-back"><i class="fa-solid fa-arrow-left"></i> Volver</button>
      </div>

      <div class="card" style="padding:12px">
        <div style="font-weight:900;margin-bottom:6px"><i class="fa-solid fa-key"></i> SesiÃ³n</div>
        <div id="session-status" class="list-item"><div id="session-status-text">No hay sesiÃ³n</div></div>
        <div class="form" id="login-form" style="margin-top:8px">
          <div class="row"><label>Usuario</label><input id="login-username" class="ctrl" placeholder="@usuario"></div>
          <div class="row"><label>ContraseÃ±a</label><input id="login-password" class="ctrl" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-primary" id="login-btn">Iniciar sesiÃ³n</button>
            <button class="btn" id="logout-btn">Cerrar sesiÃ³n</button>
          </div>
        </div>
      </div>

      <div class="card" style="padding:12px; margin-top:8px">
        <div style="font-weight:900;margin-bottom:6px"><i class="fa-solid fa-user-plus"></i> Agregar cuenta manual</div>
        <div class="form">
          <div class="row"><label>Usuario</label><input id="manual-username" class="ctrl" placeholder="@usuario"></div>
          <div class="row"><label>ContraseÃ±a</label><input id="manual-password" class="ctrl" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <button class="btn btn-primary" id="add-account-btn">Guardar Cuenta</button>
        </div>
      </div>

      <div class="card" style="padding:12px; margin-top:8px">
        <div style="font-weight:900;margin-bottom:6px"><i class="fa-solid fa-list-check"></i> Cuentas activas</div>
        <div id="active-accounts">Cargandoâ€¦</div>
      </div>

      <div class="card" style="padding:12px; margin-top:8px">
        <div style="font-weight:900;margin-bottom:6px"><i class="fa-solid fa-magnifying-glass"></i> Buscar usuario (Instagram)</div>
        <div class="form">
          <div class="row"><label>@usuario</label><input id="username-search" class="ctrl" placeholder="@username"></div>
          <button class="btn" id="search-user-btn">Buscar</button>
        </div>
        <div id="user-result" style="display:none;margin-top:8px">
          <div style="display:flex;align-items:center;gap:10px">
            <img id="user-avatar" style="width:58px;height:58px;border-radius:12px;border:1px solid var(--line);object-fit:cover" alt="">
            <div>
              <div style="font-weight:900" id="user-username"></div>
              <div class="muted" id="user-fullname"></div>
            </div>
          </div>
          <div class="list" style="grid-template-columns:repeat(3,1fr);margin-top:8px">
            <div class="list-item"><div class="muted">Posts</div><div id="user-posts">0</div></div>
            <div class="list-item"><div class="muted">Seguidores</div><div id="user-followers">0</div></div>
            <div class="list-item"><div class="muted">Siguiendo</div><div id="user-following">0</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ajustes -->
  <div class="panel" id="settings-panel">
    <div class="inner">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="font-weight:900"><i class="fa-solid fa-gear"></i> Ajustes</div>
        <button class="btn" id="set-back"><i class="fa-solid fa-arrow-left"></i> Volver</button>
      </div>
      <div class="card" style="padding:12px">
        <div style="font-weight:900;margin-bottom:6px"><i class="fa-solid fa-wand-magic-sparkles"></i> Apariencia</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="toggle-theme"><i class="fa-solid fa-sun"></i> Alternar tema</button>
          <button class="btn" id="toggle-aurora"><i class="fa-regular fa-lightbulb"></i> Aurora on/off</button>
          <button class="btn" id="bigger-tiles"><i class="fa-solid fa-maximize"></i> Tiles grandes</button>
          <button class="btn" id="smaller-tiles"><i class="fa-solid fa-minimize"></i> Tiles compactas</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Tabbar ===== -->
  <nav class="tabbar">
    <button class="tab active" data-tab="home"><i class="fa-solid fa-house"></i><span>Inicio</span></button>
    <button class="tab" data-tab="accounts"><i class="fa-solid fa-users"></i><span>Cuentas</span></button>
    <button class="tab" data-tab="actions"><i class="fa-solid fa-screwdriver-wrench"></i><span>Acciones</span></button>
    <button class="tab" data-tab="farm"><i class="fa-solid fa-mobile-screen-button"></i><span>Farm</span></button>
    <button class="tab" data-tab="settings"><i class="fa-solid fa-gear"></i><span>Ajustes</span></button>
  </nav>

  <!-- ===== Toast ===== -->
  <div class="toast" id="toast"><span id="toast-text"></span></div>

  <script>
    const API_URL="https://api.kraveapi.xyz";

    /* Theme init */
    const themeBtn=document.getElementById('theme-btn');
    (function initTheme(){
      const t=localStorage.getItem('krave.theme');
      if(t==='light') document.documentElement.classList.add('light');
      themeBtn.querySelector('i').className=document.documentElement.classList.contains('light')?'fa-solid fa-sun':'fa-solid fa-moon';
    })();
    function toggleTheme(){
      document.documentElement.classList.toggle('light');
      const light=document.documentElement.classList.contains('light');
      themeBtn.querySelector('i').className= light?'fa-solid fa-sun':'fa-solid fa-moon';
      localStorage.setItem('krave.theme',light?'light':'dark');
    }
    themeBtn.addEventListener('click',toggleTheme);
    document.getElementById('toggle-theme')?.addEventListener('click',toggleTheme);
    document.getElementById('toggle-aurora')?.addEventListener('click',()=>{const a=document.querySelector('.aurora'); a.style.display=(a.style.display==='none'?'block':'none');});
    document.getElementById('bigger-tiles')?.addEventListener('click',()=>document.documentElement.style.setProperty('--r','22px'));
    document.getElementById('smaller-tiles')?.addEventListener('click',()=>document.documentElement.style.setProperty('--r','10px'));

    /* Tabs internas */
    document.querySelectorAll('.tabmini').forEach(b=>{
      b.addEventListener('click',()=>{
        document.querySelectorAll('.tabmini').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
        b.classList.add('active');
        document.getElementById('view-'+b.dataset.tview).classList.add('active');
      });
    });

    /* Toast */
    function toast(msg,err=false){
      const t=document.getElementById('toast'); const s=document.getElementById('toast-text');
      s.textContent=msg; t.style.borderColor=err?'var(--err)':'var(--line)'; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2100);
      if('vibrate' in navigator) navigator.vibrate(12);
    }
    document.getElementById('credit').addEventListener('click',()=>toast('Created by Karmean GÃ³mez'));

    /* Health badge */
    async function checkHealth(){
      try{ const r=await fetch(`${API_URL}/health`,{credentials:'include'});
        document.getElementById('status-text').textContent = r.ok?'Conectado':'Error de conexiÃ³n';
      }catch{ document.getElementById('status-text').textContent='Error de conexiÃ³n'; }
    }
    checkHealth(); setInterval(checkHealth,120000);

    /* ===== Service Center ===== */
    const SERVICES={
      instagram:{label:'Instagram',actions:{
        comentarios:{label:'Comentarios masivos',icon:'fa-regular fa-comment',endpoint:`${API_URL}/instagram/comentarios`,fields:[
          {key:'url',label:'URL del Post',type:'text',required:true,placeholder:'https://www.instagram.com/p/Cxxxxx/'},
          {key:'cantidad',label:'Cantidad',type:'number',min:1,max:200,value:30},
          {key:'modo',label:'Modo',type:'select',options:[{v:'auto',t:'Auto (imagen)'},{v:'personalizado',t:'Personalizado'},{v:'manual',t:'Manual'}]},
          {key:'comentarios',label:'Comentarios (uno por lÃ­nea)',type:'textarea',showIf:{field:'modo',equals:'manual'}},
          {key:'apodo',label:'Apodo',type:'text'},{key:'estilo',label:'Estilo',type:'text',placeholder:'fitness, guapoâ€¦'},
          {key:'actividad',label:'Actividad',type:'text',placeholder:'entrenador personal'}
        ]},
        likes:{label:'Likes',icon:'fa-regular fa-heart',endpoint:`${API_URL}/instagram/likes`,fields:[
          {key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:1,max:500,value:50}
        ]},
        seguidores:{label:'Seguidores',icon:'fa-solid fa-user-plus',endpoint:`${API_URL}/instagram/seguidores`,fields:[
          {key:'usuario',label:'Usuario objetivo',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:1,max:1000,value:100}
        ]},
        vistas:{label:'Vistas',icon:'fa-regular fa-eye',endpoint:`${API_URL}/instagram/vistas`,fields:[
          {key:'url',label:'URL del Reel/Video',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:50000,value:1000}
        ]}
      }},
      tiktok:{label:'TikTok',actions:{
        vistas:{label:'Vistas',icon:'fa-regular fa-eye',endpoint:`${API_URL}/tiktok/vistas`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:100000,value:5000}]},
        likes:{label:'Likes',icon:'fa-regular fa-heart',endpoint:`${API_URL}/tiktok/likes`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:100000,value:1000}]},
        seguidores:{label:'Seguidores',icon:'fa-solid fa-user-plus',endpoint:`${API_URL}/tiktok/seguidores`,fields:[{key:'usuario',label:'Usuario objetivo',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:10000,value:300}]}
      }},
      youtube:{label:'YouTube',actions:{
        vistas:{label:'Vistas',icon:'fa-regular fa-eye',endpoint:`${API_URL}/youtube/vistas`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:500000,value:10000}]},
        likes:{label:'Likes',icon:'fa-regular fa-thumbs-up',endpoint:`${API_URL}/youtube/likes`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:10,max:100000,value:500}]},
        comentarios:{label:'Comentarios',icon:'fa-regular fa-comment',endpoint:`${API_URL}/youtube/comentarios`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'comentarios',label:'Comentarios',type:'textarea',required:true}]}
      }},
      x:{label:'X (Twitter)',actions:{
        likes:{label:'Me gusta',icon:'fa-regular fa-heart',endpoint:`${API_URL}/x/likes`,fields:[{key:'url',label:'URL del post',type:'text',required:true}]},
        retweets:{label:'Reposts',icon:'fa-solid fa-retweet',endpoint:`${API_URL}/x/retweets`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:1,max:500,value:50}]},
        follows:{label:'Seguir cuentas',icon:'fa-solid fa-user-plus',endpoint:`${API_URL}/x/seguidores`,fields:[{key:'usuario',label:'Usuario objetivo',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:1,max:1000,value:100}]}
      }},
      facebook:{label:'Facebook',actions:{
        likes:{label:'Reacciones',icon:'fa-regular fa-thumbs-up',endpoint:`${API_URL}/facebook/reacciones`,fields:[{key:'url',label:'URL del post',type:'text',required:true},{key:'tipo',label:'Tipo',type:'select',options:[{v:'like',t:'ðŸ‘ Like'},{v:'love',t:'â¤ï¸ Love'},{v:'care',t:'ðŸ¥° Care'}]}]},
        comentarios:{label:'Comentarios',icon:'fa-regular fa-comment',endpoint:`${API_URL}/facebook/comentarios`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'comentarios',label:'Comentarios',type:'textarea',required:true}]}
      }},
      threads:{label:'Threads',actions:{
        likes:{label:'Likes',icon:'fa-regular fa-heart',endpoint:`${API_URL}/threads/likes`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'cantidad',label:'Cantidad',type:'number',min:1,max:1000,value:100}]},
        comentarios:{label:'Respuestas',icon:'fa-regular fa-comment',endpoint:`${API_URL}/threads/respuestas`,fields:[{key:'url',label:'URL',type:'text',required:true},{key:'comentarios',label:'Respuestas (una por lÃ­nea)',type:'textarea'}]}
      }}
    };

    const svcPanel=document.getElementById('svc-panel'), svcGrid=document.getElementById('svc-grid');
    const svcFormCard=document.getElementById('svc-form-card'), svcForm=document.getElementById('svc-form');
    const svcRun=document.getElementById('svc-run'); let CURRENT_ENDPOINT=null;

    function openServiceCenter(platform){
      const def=SERVICES[platform]; if(!def){ toast('PrÃ³ximamente',true); return; }
      document.getElementById('svc-title').textContent=def.label;
      svcPanel.classList.add('active'); svcGrid.innerHTML=''; svcFormCard.style.display='none';
      Object.values(def.actions).forEach(cfg=>{
        const el=document.createElement('div'); el.className='card svc-card';
        el.innerHTML=`<div class="title"><i class="${cfg.icon}"></i>${cfg.label}</div><div class="hint">${cfg.endpoint.replace(API_URL,'')}</div>`;
        el.addEventListener('click',()=>openAction(cfg)); svcGrid.appendChild(el);
      });
    }
    function openAction(cfg){
      CURRENT_ENDPOINT=cfg.endpoint; svcFormCard.style.display='block';
      document.getElementById('svc-form-title').innerHTML=`<i class="fa-solid fa-sliders"></i> ${cfg.label}`;
      svcForm.innerHTML='';
      (cfg.fields||[]).forEach(f=>{
        const row=document.createElement('div'); row.className='row'; row.innerHTML=`<label>${f.label}</label>`;
        let el;
        if(f.type==='textarea'){ el=document.createElement('textarea'); el.className='ctrl'; el.name=f.key; el.placeholder=f.placeholder||''; el.required=!!f.required; }
        else if(f.type==='select'){ el=document.createElement('select'); el.className='ctrl'; el.name=f.key; (f.options||[]).forEach(o=>{const op=document.createElement('option'); op.value=o.v; op.textContent=o.t; el.appendChild(op);});}
        else { el=document.createElement('input'); el.className='ctrl'; el.type=f.type||'text'; el.name=f.key; if(f.value!=null) el.value=f.value; if(f.min!=null) el.min=f.min; if(f.max!=null) el.max=f.max; el.placeholder=f.placeholder||''; el.required=!!f.required; }
        if(f.showIf){ el.dataset.dep=f.showIf.field; el.dataset.depval=f.showIf.equals; }
        row.appendChild(el); svcForm.appendChild(row);
      });
      applyDeps(); svcForm.querySelectorAll('select,input').forEach(i=>i.addEventListener('change',applyDeps));
      function applyDeps(){ const st=Object.fromEntries(new FormData(svcForm).entries());
        [...svcForm.querySelectorAll('[data-dep]')].forEach(el=>{ const row=el.closest('.row'); row.style.display=(st[el.dataset.dep]===el.dataset.depval)?'grid':'none'; });
      }
    }
    document.getElementById('svc-back').addEventListener('click',()=>svcPanel.classList.remove('active'));
    document.getElementById('svc-cancel').addEventListener('click',(e)=>{e.preventDefault();svcFormCard.style.display='none';});
    svcRun.addEventListener('click',async (e)=>{
      e.preventDefault(); if(!CURRENT_ENDPOINT) return;
      const payload=Object.fromEntries(new FormData(svcForm).entries());
      try{
        svcRun.disabled=true; svcRun.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Ejecutandoâ€¦';
        const r=await fetch(CURRENT_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(payload)});
        const data=await r.json().catch(()=>({status:'ok'})); toast(data.message||'Tarea lanzada');
        const k=document.getElementById('svc-kpis'); k.innerHTML='';
        if(data.kpis) Object.entries(data.kpis).forEach(([key,val])=>{const c=document.createElement('div'); c.className='card'; c.style.padding='10px'; c.innerHTML=`<div class="muted">${key}</div><div style="font-weight:900">${val}</div>`; k.appendChild(c);});
      }catch{ toast('Error al ejecutar servicio',true) }
      finally{ svcRun.disabled=false; svcRun.innerHTML='<i class="fa-solid fa-play"></i> Ejecutar'; }
    });

    // Abrir Service Center desde tiles
    document.getElementById('social-grid').addEventListener('click',(e)=>{
      const tile=e.target.closest('.tile[data-platform]'); if(!tile) return; openServiceCenter(tile.dataset.platform);
    });

    /* ===== Device Farm ===== */
    const farmPanel=document.getElementById('farm-panel'), farmGrid=document.getElementById('farm-grid');
    document.getElementById('open-farm').addEventListener('click',()=>{ farmPanel.classList.add('active'); loadDevices(); });
    document.querySelector('[data-tab="farm"]').addEventListener('click',()=>{ farmPanel.classList.add('active'); loadDevices(); });
    document.getElementById('farm-back').addEventListener('click',()=>farmPanel.classList.remove('active'));
    document.getElementById('zoom-in').addEventListener('click',()=>setDeviceHeight(Math.min(getDeviceHeight()+30,460)));
    document.getElementById('zoom-out').addEventListener('click',()=>setDeviceHeight(Math.max(getDeviceHeight()-30,140)));
    let sse=null;

    function setDeviceHeight(px){ document.documentElement.style.setProperty('--device-h',px+'px'); }
    function getDeviceHeight(){ return parseInt(getComputedStyle(document.documentElement).getPropertyValue('--device-h'))||230; }

    async function loadDevices(){
      try{
        const r=await fetch(`${API_URL}/devices`,{credentials:'include'}); const list=await r.json();
        renderDevices(list||[]); attachSSE();
      }catch{ toast('No se pudo cargar la farm',true) }
    }
    function renderDevices(list){ farmGrid.innerHTML=''; list.forEach(d=>farmGrid.appendChild(deviceCard(d))); }
    function deviceCard(d){
      const card=document.createElement('div'); card.className='card device'; card.dataset.id=d.id;
      const head=document.createElement('div'); head.className='device-head';
      head.innerHTML=`<div>${d.emoji||'ðŸ“±'} <strong>${d.name||d.model||'Device'}</strong> Â· ${d.platform||''}</div>`;
      const chips=document.createElement('div'); chips.className='chips';
      chips.innerHTML=`<span class="chip-b">${d.status||'idle'}</span>${d.ip?`<span class="chip-b">${d.ip}</span>`:''}`;
      head.appendChild(chips);

      const screen=document.createElement('div'); screen.className='device-screen';
      const overlay=document.createElement('div'); overlay.className='overlay'; overlay.innerHTML=`<span class="chip-b">${d.task||'Idle'}</span>`;
      const vid=document.createElement('video'); vid.autoplay=true; vid.muted=true; vid.playsInline=true; vid.controls=false; vid.style.display='none';
      const img=document.createElement('img'); if(d.mjpeg_url) img.src=d.mjpeg_url; img.alt='stream';
      screen.append(overlay,vid,img);

      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
      actions.append(btn('Iniciar',()=>ctrl(d.id,'start')), btn('Detener',()=>ctrl(d.id,'stop')), btn('Fullscreen',()=>screen.requestFullscreen && screen.requestFullscreen(), true));
      card.append(head,screen,actions);

      if(d.webrtc) openStream(d.id,vid,img);
      return card;
    }
    function btn(t,fn,ghost=false){ const b=document.createElement('button'); b.className='btn'+(ghost?'':' btn-primary'); b.textContent=t; b.onclick=fn; return b }
    async function ctrl(id,action){
      try{
        const r=await fetch(`${API_URL}/devices/${id}/control`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({action})});
        const d=await r.json(); toast(d.message||'OK');
      }catch{ toast('Error enviando comando',true) }
    }
    function attachSSE(){
      try{ if(sse) sse.close();
        sse=new EventSource(`${API_URL}/devices/subscribe`,{withCredentials:true});
        sse.onmessage=(ev)=>{ try{ const m=JSON.parse(ev.data||'{}'); if(m.type==='device.update') updateDevice(m.payload) }catch{} };
      }catch{}
    }
    function updateDevice(d){
      const card=farmGrid.querySelector(`[data-id="${d.id}"]`);
      if(!card){ farmGrid.appendChild(deviceCard(d)); return; }
      card.querySelector('.device-head div').innerHTML=`${d.emoji||'ðŸ“±'} <strong>${d.name||d.model||'Device'}</strong> Â· ${d.platform||''}`;
      card.querySelector('.chips').innerHTML=`<span class="chip-b">${d.status||'idle'}</span>${d.ip?`<span class="chip-b">${d.ip}</span>`:''}`;
      card.querySelector('.overlay').innerHTML=`<span class="chip-b">${d.task||'Idle'}</span>`;
      if(d.mjpeg_url){ const im=card.querySelector('img'); if(im && im.src!==d.mjpeg_url) im.src=d.mjpeg_url; }
      if(d.webrtc){ const v=card.querySelector('video'); const im=card.querySelector('img'); openStream(d.id,v,im); }
    }
    async function openStream(id,video,img){
      try{
        const pc=new RTCPeerConnection(); pc.ontrack=(e)=>{ video.srcObject=e.streams[0]; video.style.display='block'; if(img) img.style.display='none'; };
        const offer=await pc.createOffer({offerToReceiveVideo:true}); await pc.setLocalDescription(offer);
        const r=await fetch(`${API_URL}/devices/${id}/stream/webrtc`,{method:'POST',headers:{'Content-Type':'application/sdp'},credentials:'include',body:offer.sdp});
        const answer=await r.text(); await pc.setRemoteDescription({type:'answer',sdp:answer});
      }catch{/* fallback a MJPEG si no hay WebRTC */}
    }

    /* ===== Accounts ===== */
    const accPanel=document.getElementById('accounts-panel');
    document.getElementById('acc-back').addEventListener('click',()=>accPanel.classList.remove('active'));
    const sessText=document.getElementById('session-status-text');
    const loginBtn=document.getElementById('login-btn'); const logoutBtn=document.getElementById('logout-btn');
    const loginUsername=document.getElementById('login-username'); const loginPassword=document.getElementById('login-password');
    const addAccountBtn=document.getElementById('add-account-btn'); const manualUsername=document.getElementById('manual-username'); const manualPassword=document.getElementById('manual-password');
    const activeAccounts=document.getElementById('active-accounts');

    async function checkSessionStatus(){
      try{ const r=await fetch(`${API_URL}/estado-sesion`,{credentials:'include'}); const data=await r.json();
        if(data.status==='activo'){ sessText.textContent=`SesiÃ³n activa como @${data.usuario}`; document.getElementById('login-form').style.display='none'; }
        else{ sessText.textContent='No hay sesiÃ³n'; document.getElementById('login-form').style.display='block'; }
      }catch{ sessText.textContent='Error al verificar sesiÃ³n'; document.getElementById('login-form').style.display='block'; }
    }
    loginBtn.addEventListener('click',async ()=>{
      const u=loginUsername.value.trim().replace('@',''); const p=loginPassword.value.trim(); if(!u||!p) return toast('Completa usuario y contraseÃ±a',true);
      try{
        loginBtn.disabled=true; loginBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Iniciandoâ€¦';
        const r=await fetch(`${API_URL}/iniciar-sesion`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:u,contrasena:p})});
        const d=await r.json(); if(!d.exito) throw new Error(d.mensaje||'Error al iniciar');
        toast(`SesiÃ³n iniciada @${d.usuario}`); checkSessionStatus(); actualizarListaCuentasActivas();
      }catch(e){ toast(e.message||'Error',true) }
      finally{ loginBtn.disabled=false; loginBtn.innerHTML='Iniciar sesiÃ³n'; }
    });
    logoutBtn.addEventListener('click',async ()=>{
      try{
        logoutBtn.disabled=true; logoutBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Cerrandoâ€¦';
        const r=await fetch(`${API_URL}/cerrar-sesion`,{credentials:'include'}); const d=await r.json();
        if(!d.exito) throw new Error(d.mensaje||'Error');
        toast('SesiÃ³n cerrada'); checkSessionStatus(); actualizarListaCuentasActivas();
      }catch(e){ toast(e.message||'Error',true) }
      finally{ logoutBtn.disabled=false; logoutBtn.innerHTML='Cerrar sesiÃ³n'; }
    });
    addAccountBtn.addEventListener('click',async ()=>{
      const u=manualUsername.value.trim().replace('@',''); const p=manualPassword.value.trim(); if(!u||!p) return toast('Completa usuario y contraseÃ±a',true);
      try{
        addAccountBtn.disabled=true; addAccountBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Guardandoâ€¦';
        const l=await fetch(`${API_URL}/iniciar-sesion`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:u,contrasena:p})});
        const lj=await l.json(); if(!lj.exito) throw new Error(lj.mensaje||'Error de login');
        const s=await fetch(`${API_URL}/guardar-cuenta`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({username:u,password:p})});
        const sj=await s.json(); if(sj.status!=='ok') throw new Error(sj.message||'No se pudo guardar');
        toast(`Cuenta @${u} guardada`); manualUsername.value=''; manualPassword.value=''; actualizarListaCuentasActivas();
      }catch(e){ toast(e.message||'Error',true) }
      finally{ addAccountBtn.disabled=false; addAccountBtn.innerHTML='Guardar Cuenta'; }
    });
    async function actualizarListaCuentasActivas(){
      try{
        const r=await fetch(`${API_URL}/cuentas-activas`,{credentials:'include'}); const cuentas=await r.json();
        if(!Array.isArray(cuentas)||!cuentas.length){ activeAccounts.textContent='No hay cuentas activas'; return; }
        const wrap=document.createElement('div'); wrap.className='list';
        cuentas.forEach(acc=>{
          const item=document.createElement('div'); item.className='list-item';
          item.innerHTML=`<div style="display:flex;align-items:center;gap:8px"><span class="chip-b">${acc.status||'idle'}</span>@${acc.username}</div>`;
          const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
          if(acc.status==='activo'){ const b=document.createElement('button'); b.className='btn'; b.textContent='Logout'; b.onclick=()=>cerrarSesionCuenta(acc.username); actions.appendChild(b); }
          else { const b=document.createElement('button'); b.className='btn btn-primary'; b.textContent='Login'; b.onclick=()=>iniciarSesionCuenta(acc.username); actions.appendChild(b); }
          item.appendChild(actions); wrap.appendChild(item);
        });
        activeAccounts.innerHTML=''; activeAccounts.appendChild(wrap);
      }catch{ activeAccounts.textContent='Error al cargar cuentas'; }
    }
    async function iniciarSesionCuenta(username){
      try{ toast(`Iniciando @${username}â€¦`); const r=await fetch(`${API_URL}/iniciar-sesion-cuenta`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:username})}); const d=await r.json(); if(!d.exito) throw new Error(d.mensaje||'Error'); toast(`SesiÃ³n iniciada @${username}`); actualizarListaCuentasActivas(); }catch(e){ toast(e.message||'Error',true) }
    }
    async function cerrarSesionCuenta(username){
      try{ toast(`Cerrando @${username}â€¦`); const r=await fetch(`${API_URL}/cerrar-sesion-cuenta`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:username})}); const d=await r.json(); if(!d.exito) throw new Error(d.mensaje||'Error'); toast(`SesiÃ³n cerrada @${username}`); actualizarListaCuentasActivas(); }catch(e){ toast(e.message||'Error',true) }
    }

    /* ===== Search user (IG) ===== */
    const searchUserBtn=document.getElementById('search-user-btn'); searchUserBtn?.addEventListener('click',searchUser);
    async function searchUser(){
      const u=document.getElementById('username-search').value.trim().replace('@',''); if(!u) return toast('Escribe un usuario',true);
      try{
        searchUserBtn.disabled=true; searchUserBtn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Buscandoâ€¦';
        const r=await fetch(`${API_URL}/buscar-usuario?username=${u}`,{credentials:'include'}); const d=await r.json();
        document.getElementById('user-avatar').src=d.profile_pic_url_hd||'https://via.placeholder.com/128?text=No+img';
        document.getElementById('user-username').textContent='@'+(d.username||u);
        document.getElementById('user-fullname').textContent=d.full_name||'';
        document.getElementById('user-posts').textContent=(d.media_count||0).toLocaleString();
        document.getElementById('user-followers').textContent=(d.follower_count||0).toLocaleString();
        document.getElementById('user-following').textContent=(d.following_count||0).toLocaleString();
        document.getElementById('user-result').style.display='block';
        toast(`Usuario @${d.username||u} encontrado`);
      }catch(e){ toast(e.message||'No se pudo buscar',true) }
      finally{ searchUserBtn.disabled=false; searchUserBtn.innerHTML='Buscar'; }
    }

    /* ===== Tabbar navigation ===== */
    document.querySelectorAll('.tabbar .tab').forEach(t=>t.addEventListener('click',()=>{
      document.querySelectorAll('.tabbar .tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
      const k=t.dataset.tab;
      if(k==='home'){ ['accounts','actions','farm','settings'].forEach(id=>document.getElementById(id+'-panel').classList.remove('active')); }
      if(k==='accounts'){ document.getElementById('accounts-panel').classList.add('active'); checkSessionStatus(); actualizarListaCuentasActivas(); }
      if(k==='actions'){ openServiceCenter('instagram'); }
      if(k==='farm'){ document.getElementById('farm-panel').classList.add('active'); loadDevices(); }
      if(k==='settings'){ document.getElementById('settings-panel').classList.add('active'); }
    }));

    // Quick automation
    document.getElementById('automation-run').addEventListener('click',()=>{
      const v=(document.getElementById('automation-input').value||'').trim();
      if(!v) return toast('Escribe quÃ© automatizar',true);
      toast(`Automatizando: "${v}"`); document.getElementById('automation-input').value='';
    });
  </script>
</body>
</html>