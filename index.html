<!DOCTYPE html>
<html lang="es" data-theme="system">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>KraveAI — Panel</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0b0d12">
<style>
/* -------------------- TOKENS -------------------- */
:root{
  /* Dark */
  --bg:#0a0e14; --elev:#0e131b; --card:#101826; --text:#e9eef7; --muted:#9aa4b2; --line:#1e2a3a;
  --grad:linear-gradient(135deg,#6ee7f9 0%, #7c5cff 40%, #22d3ee 100%);
  --ac:#7c5cff; --ok:#22c55e; --err:#ef4444;
  --r:16px; --gap:14px; --shadow:0 18px 50px rgba(0,0,0,.35);
}
[data-theme="light"]{
  --bg:#f7f9fc; --elev:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#667389; --line:#e5e9f2;
  --shadow:0 16px 40px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:15px/1.45 system-ui,-apple-system,"SF Pro Text",Inter,Roboto;
}
.app{min-height:100svh;display:grid;grid-template-rows:auto 1fr auto}

/* -------------------- TOP BAR -------------------- */
.top{
  position:sticky; top:0; z-index:40;
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px;
  padding:10px max(14px,env(safe-area-inset-left)) 8px max(14px,env(safe-area-inset-right));
  background:color-mix(in oklab,var(--elev) 92%, transparent);
  border-bottom:1px solid var(--line);
  backdrop-filter:saturate(1.1) blur(14px);
}
.brand{display:flex;align-items:center;gap:10px}
.badge{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:var(--grad); box-shadow:0 10px 22px rgba(124,92,255,.28),0 8px 16px rgba(0,211,194,.16)}
.word{font-weight:900;letter-spacing:.14em; font-size:clamp(15px,2.2vw,18px); }
.status{justify-self:center; display:flex; align-items:center; gap:8px; color:var(--muted); font-size:.9rem}
.status .dot{width:8px;height:8px;border-radius:50%;background:#8b8b8b}
.tog{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;cursor:pointer;background:rgba(255,255,255,.05);border:1px solid var(--line)}
.icon-moon{display:none}
[data-theme="light"] .icon-sun{display:none}
[data-theme="light"] .icon-moon{display:block}

/* -------------------- NAV (tabs) -------------------- */
.nav{
  position:sticky; bottom:0; z-index:35;
  display:grid; grid-template-columns:repeat(4,1fr); gap:8px;
  padding:8px max(12px,env(safe-area-inset-left)) calc(8px + env(safe-area-inset-bottom)) max(12px,env(safe-area-inset-right));
  background:color-mix(in oklab,var(--elev) 92%, transparent);
  border-top:1px solid var(--line);
  backdrop-filter:saturate(1.1) blur(14px);
}
.tab{display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px;border-radius:12px;color:var(--muted);border:1px solid transparent;cursor:pointer}
.tab small{font-size:.74rem}
input[name="tab"]{position:absolute;opacity:0;pointer-events:none}
#t-home:checked ~ .app .nav label[for="t-home"],
#t-services:checked ~ .app .nav label[for="t-services"],
#t-clients:checked ~ .app .nav label[for="t-clients"],
#t-farm:checked ~ .app .nav label[for="t-farm"]{
  color:var(--text); background:rgba(255,255,255,.06); border-color:var(--line);
}

/* -------------------- MAIN / VIEWS -------------------- */
.main{height:calc(100svh - 56px - 64px - env(safe-area-inset-top) - env(safe-area-inset-bottom)); overflow:auto}
.view{display:none; animation:fade .16s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
#t-home:checked ~ .app .view[data-tab="home"],
#t-services:checked ~ .app .view[data-tab="services"],
#t-clients:checked ~ .app .view[data-tab="clients"],
#t-farm:checked ~ .app .view[data-tab="farm"]{display:block}

.container{max-width:min(980px, 92vw); margin:0 auto; padding:14px}
.h1{font-size:clamp(24px,5.4vw,34px); font-weight:900; margin:8px 0 6px}
.sub{color:var(--muted); margin-bottom:18px; font-size:clamp(14px,2.8vw,16px)}

/* -------------------- ORB (animado) -------------------- */
.hero{
  display:grid; grid-template-columns:1fr auto; align-items:center; gap:16px;
  margin-top:10px;
}
.orb-wrap{position:relative; width:clamp(120px,28vw,200px); height:clamp(120px,28vw,200px)}
.orb{
  position:absolute; inset:0; border-radius:50%;
  background:radial-gradient(40% 40% at 30% 30%, #7c5cff 0%, transparent 60%),
             radial-gradient(50% 60% at 70% 60%, #22d3ee 0%, transparent 70%),
             radial-gradient(45% 45% at 50% 50%, #6ee7f9 0%, transparent 75%),
             #0b1020;
  box-shadow:0 30px 70px rgba(34,211,238,.28), 0 10px 30px rgba(124,92,255,.18);
  animation:spin 14s linear infinite;
}
.orb::after{
  content:""; position:absolute; inset:-6px; border-radius:50%;
  background:conic-gradient(from 0deg, #6ee7f9, #7c5cff, #22d3ee, #6ee7f9);
  filter:blur(6px); opacity:.65; animation:pulse 4s ease-in-out infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{50%{opacity:.25; transform:scale(1.02)}}

/* -------------------- SOCIAL BUTTONS -------------------- */
.social-grid{
  display:grid; gap:12px; grid-template-columns:repeat(2,minmax(0,1fr));
}
@media (min-width:680px){ .social-grid{grid-template-columns:repeat(3,1fr)} }
@media (min-width:920px){ .social-grid{grid-template-columns:repeat(4,1fr)} }

.sbtn{
  display:flex; align-items:center; gap:12px; padding:14px 16px;
  background:var(--card); border:1px solid var(--line); border-radius:14px;
  box-shadow:var(--shadow); cursor:pointer; transition:transform .14s ease, box-shadow .2s ease;
}
.sbtn:hover{ transform:translateY(-2px); box-shadow:0 14px 30px rgba(0,0,0,.18) }
.sicon{ width:28px; height:28px; display:grid; place-items:center; border-radius:8px; background:rgba(255,255,255,.06) }
.stext{ font-weight:800; }

/* -------------------- CLIENTS -------------------- */
.section-title{font-weight:900; margin:16px 0 8px}
.client-list{display:grid; gap:10px}
.client{
  display:flex; align-items:center; gap:12px; padding:12px 14px;
  background:var(--card); border:1px solid var(--line); border-radius:14px;
}
.avatar{position:relative; width:36px; height:36px; border-radius:50%; overflow:hidden; background:
  radial-gradient(circle at 60% 110%, #feda75 0, #d62976 25%, #962fbf 50%, #4f5bd5 75%);}
.avatar img{width:100%; height:100%; object-fit:cover}
.badge-ig{position:absolute; right:-3px; bottom:-3px; width:18px; height:18px; background:#0095F6; color:#fff; border-radius:50%; display:grid; place-items:center; border:2px solid var(--card)}
.handle{font-weight:800}
.platform{color:var(--muted); font-size:.9rem; margin-left:6px}
.right-logo{margin-left:auto; opacity:.9}

/* -------------------- INPUT QUICK -------------------- */
.quick{
  margin-top:10px; display:flex; align-items:center; gap:8px;
  background:var(--card); border:1px solid var(--line); border-radius:14px; padding:10px 10px 10px 12px;
}
.quick input{flex:1; background:transparent; border:0; outline:none; color:var(--text); font-size:1rem}
.btn{border:1px solid var(--line); background:var(--grad); color:#0b0d13; padding:10px 14px; border-radius:12px; font-weight:900; cursor:pointer}

/* -------------------- SERVICES -------------------- */
.panel{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:14px; box-shadow:var(--shadow)}
.service-grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.service-card{background:linear-gradient(180deg,color-mix(in oklab,var(--card) 96%, transparent), color-mix(in oklab,var(--card) 100%, transparent)); border:1px solid var(--line); border-radius:14px; padding:12px}

/* -------------------- FARM -------------------- */
.farm-grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr))}
.dev{display:grid; gap:8px; background:var(--card); border:1px solid var(--line); border-radius:16px; padding:12px}
.dev-head{display:flex; align-items:center; justify-content:space-between; gap:8px; font-size:.94rem}
.chips{display:flex; gap:6px; flex-wrap:wrap}
.chip{padding:6px 8px; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.04); font-size:.78rem}
.chip[data-live="1"]{background:rgba(34,197,94,.12); color:#22c55e; border-color:#22c55e}
.screen{border:1px solid var(--line); border-radius:14px; overflow:hidden; background:#000; height:220px; position:relative}
.screen iframe,.screen video,.screen img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
.screen .placeholder{position:absolute;inset:0;background:radial-gradient(120% 80% at 10% 10%, rgba(124,92,255,.25), transparent 60%),radial-gradient(120% 80% at 90% 90%, rgba(0,211,194,.18), transparent 60%),#000}
.dev-actions{display:flex;gap:8px;flex-wrap:wrap}
.btn-outline{border:1px solid var(--line); background:transparent; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}

/* -------------------- CREDIT -------------------- */
.credit{
  position:fixed; right:14px; bottom: calc(64px + env(safe-area-inset-bottom) + 10px);
  z-index:50; font-size:.86rem; color:var(--text);
  background:linear-gradient(180deg, color-mix(in oklab, var(--elev) 96%, transparent), color-mix(in oklab,var(--elev) 98%, transparent));
  border:1px solid var(--line); border-radius:999px; padding:8px 12px;
  box-shadow:0 0 16px rgba(124,92,255,.55), 0 0 28px rgba(0,211,194,.35);
  animation:glow 3.2s ease-in-out infinite;
  backdrop-filter:blur(6px);
}
@keyframes glow{
  50%{ box-shadow:0 0 26px rgba(124,92,255,.75), 0 0 40px rgba(0,211,194,.5); transform:translateY(-1px) }
}
</style>
</head>
<body>

<!-- Tabs (sin JS) -->
<input type="radio" name="tab" id="t-home" checked>
<input type="radio" name="tab" id="t-services">
<input type="radio" name="tab" id="t-clients">
<input type="radio" name="tab" id="t-farm">

<!-- SPRITE: logos -->
<svg width="0" height="0" aria-hidden="true" style="position:absolute">
  <defs>
    <symbol id="i-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="i-moon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.4 5.4 0 0 1-4.4 2.26 5.4 5.4 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>

    <!-- Logos oficiales (minimal, vectorizados) -->
    <symbol id="lg-ig" viewBox="0 0 24 24">
      <rect x="3" y="3" width="18" height="18" rx="5" fill="none" stroke="#E1306C" stroke-width="2"/>
      <circle cx="12" cy="12" r="4" fill="none" stroke="#E1306C" stroke-width="2"/>
      <circle cx="17.2" cy="6.8" r="1.2" fill="#E1306C"/>
    </symbol>
    <symbol id="lg-tt" viewBox="0 0 24 24">
      <path d="M10 4v9.2a3.8 3.8 0 1 1-2.8 6.2" fill="none" stroke="#69C9D0" stroke-width="2"/>
      <path d="M14 4c.5 2.3 2.2 4 5 4" fill="none" stroke="#ff0050" stroke-width="2"/>
    </symbol>
    <symbol id="lg-yt" viewBox="0 0 24 24">
      <rect x="3" y="6" width="18" height="12" rx="3" fill="#FF0000"/><path d="M10 9l6 3-6 3z" fill="#fff"/>
    </symbol>
    <symbol id="lg-th" viewBox="0 0 24 24"><path d="M6 12c0-4 3-7 6-7s6 3 6 7-3 7-6 7c-2 0-3.5-1-3.5-2.5S9 14 12 14c2.5 0 3.8-1.2 3.8-3S14.5 8 12 8" fill="none" stroke="#000" stroke-width="2"/></symbol>
    <symbol id="lg-x" viewBox="0 0 24 24"><path d="M4 4l16 16M20 4L4 20" stroke="#fff" stroke-width="2"/></symbol>
    <symbol id="lg-fb" viewBox="0 0 24 24"><path d="M14 8h3V5h-3c-2 0-3 .9-3 3v2H8v3h3v6h3v-6h3l1-3h-4V8c0-.7.3-1 1-1z" fill="#1877F2"/></symbol>
    <symbol id="lg-li" viewBox="0 0 24 24"><rect x="3" y="8" width="4" height="12" fill="#0A66C2"/><circle cx="5" cy="5.5" r="2" fill="#0A66C2"/><rect x="9" y="8" width="12" height="12" rx="2" fill="none" stroke="#0A66C2" stroke-width="2"/></symbol>
    <symbol id="lg-sp" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#1DB954"/><path d="M7 10c3-1 7-1 10 1M7 13c3-1 6-1 9 1M7 16c2-.5 4-.5 6 .5" stroke="#fff" stroke-width="2" fill="none"/></symbol>
    <symbol id="lg-tg" viewBox="0 0 24 24"><path d="M21 3L3 11l6 2 2 6 3-4 4-10z" fill="#0088cc"/></symbol>
    <symbol id="lg-wa" viewBox="0 0 24 24"><path d="M12 3a9 9 0 0 1 0 18 9.4 9.4 0 0 1-4-.9L5 21l.9-3.1A9.4 9.4 0 0 1 3 12 9 9 0 0 1 12 3z" fill="#25D366"/><path d="M9 8c0 3 3 6 5 6l1-1" stroke="#fff" stroke-width="2"/></symbol>
  </defs>
</svg>

<div class="app" id="app">
  <!-- TOP -->
  <header class="top">
    <div class="brand">
      <div class="badge"></div>
      <div class="word">KraveAI</div>
    </div>
    <div class="status"><span class="dot" id="dot"></span><small id="stat">Conectando…</small></div>
    <button class="tog" id="themeBtn" aria-label="Cambiar tema">
      <svg class="icon-sun" width="18" height="18"><use href="#i-sun"/></svg>
      <svg class="icon-moon" width="18" height="18"><use href="#i-moon"/></svg>
    </button>
  </header>

  <main class="main">
    <!-- HOME -->
    <section class="view" data-tab="home">
      <div class="container">
        <div class="hero">
          <div>
            <div class="h1">Redes sociales</div>
            <div class="sub">Domina todas tus redes con IA</div>
          </div>
          <div class="orb-wrap"><div class="orb" aria-hidden="true"></div></div>
        </div>

        <div class="section-title">Redes sociales</div>
        <div class="social-grid" id="socialGrid"></div>

        <div class="section-title">Clientes recientes</div>
        <div class="client-list" id="clientList"></div>

        <div class="quick">
          <span>➕</span>
          <input id="quickInput" placeholder="¿Qué quieres automatizar hoy?">
          <button class="btn" id="quickBtn">Enviar</button>
        </div>
      </div>
    </section>

    <!-- SERVICES -->
    <section class="view" data-tab="services">
      <div class="container">
        <button id="backHome" class="btn-outline" style="margin-bottom:10px">← Volver</button>
        <div class="h1" id="svcTitle">Servicios</div>
        <div class="panel" id="svcInstagram">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
            <div class="sicon"><svg width="22" height="22"><use href="#lg-ig"/></svg></div>
            <strong>Instagram</strong>
          </div>
          <div class="service-grid">
            <div class="service-card"><strong>Comentarios</strong><div class="sub">Masivo / Auto / Personalizado</div></div>
            <div class="service-card"><strong>Likes</strong></div>
            <div class="service-card"><strong>Seguidores</strong></div>
            <div class="service-card"><strong>Vistas</strong></div>
          </div>
        </div>

        <div class="panel" id="svcTikTok" style="margin-top:14px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
            <div class="sicon"><svg width="22" height="22"><use href="#lg-tt"/></svg></div>
            <strong>TikTok</strong>
          </div>
          <div class="service-grid">
            <div class="service-card"><strong>Vistas</strong></div>
            <div class="service-card"><strong>Likes</strong></div>
            <div class="service-card"><strong>Seguidores</strong></div>
          </div>
        </div>

        <!-- Añade más paneles según avances -->
      </div>
    </section>

    <!-- CLIENTS -->
    <section class="view" data-tab="clients">
      <div class="container">
        <div class="h1">Clientes recientes</div>
        <div class="sub">Cuentas verificadas en Instagram</div>
        <div class="client-list" id="clientList2"></div>
      </div>
    </section>

    <!-- FARM -->
    <section class="view" data-tab="farm">
      <div class="container">
        <div class="h1">Device Farm</div>
        <label style="display:flex;align-items:center;gap:8px;margin:8px 0 14px">
          <input type="checkbox" id="denseToggle"> Vista densa
        </label>
        <div class="farm-grid" id="farmGrid"></div>
      </div>
    </section>
  </main>

  <!-- CREDIT -->
  <div class="credit">Created by Karmean Gómez</div>

  <!-- BOTTOM NAV -->
  <nav class="nav">
    <label class="tab" for="t-home">🏠<small>Inicio</small></label>
    <label class="tab" for="t-services">🛠️<small>Servicios</small></label>
    <label class="tab" for="t-clients">👥<small>Clientes</small></label>
    <label class="tab" for="t-farm">📱<small>Farm</small></label>
  </nav>
</div>

<script>
(function(){
  const API_URL = "https://api.kraveapi.xyz";

  /* ---------- Tema (system / light / dark) ---------- */
  const themeBtn = document.getElementById('themeBtn');
  const saved = localStorage.getItem('krv_theme') || 'system';
  setTheme(saved);
  themeBtn.addEventListener('click', ()=>{
    const next = (document.documentElement.getAttribute('data-theme')==='light')?'dark':'light';
    setTheme(next);
    localStorage.setItem('krv_theme', next);
  });
  function setTheme(mode){
    if(mode==='system'){
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.setAttribute('data-theme', prefersDark? 'dark':'light');
    }else{
      document.documentElement.setAttribute('data-theme', mode);
    }
  }

  /* ---------- Estado backend ---------- */
  const dot = document.getElementById('dot'), stat = document.getElementById('stat');
  async function health(){
    try{
      const r = await fetch(`${API_URL}/health`, {credentials:'include'});
      dot.style.background = r.ok ? 'var(--ok)' : 'var(--err)';
      stat.textContent = r.ok ? 'Conectado' : 'Sin conexión';
    }catch{
      dot.style.background = 'var(--err)';
      stat.textContent = 'Sin conexión';
    }
  }
  health(); setInterval(health, 120000);

  /* ---------- Home: botones de redes (sin servicios aquí) ---------- */
  const socials = [
    {key:'instagram', label:'Instagram', icon:'#lg-ig'},
    {key:'tiktok', label:'TikTok', icon:'#lg-tt'},
    {key:'youtube', label:'YouTube', icon:'#lg-yt'},
    {key:'threads', label:'Threads', icon:'#lg-th'},
    {key:'x', label:'X', icon:'#lg-x'},
    {key:'facebook', label:'Facebook', icon:'#lg-fb'},
    {key:'linkedin', label:'LinkedIn', icon:'#lg-li'},
    {key:'spotify', label:'Spotify', icon:'#lg-sp'},
    {key:'telegram', label:'Telegram', icon:'#lg-tg'},
    {key:'whatsapp', label:'WhatsApp', icon:'#lg-wa'},
  ];
  const socialGrid = document.getElementById('socialGrid');
  socialGrid.innerHTML = socials.map(s=>`
    <button class="sbtn" data-target="${s.key}">
      <span class="sicon"><svg width="20" height="20"><use href="${s.icon}"/></svg></span>
      <span class="stext">${s.label}</span>
    </button>
  `).join('');
  socialGrid.addEventListener('click', e=>{
    const b = e.target.closest('.sbtn'); if(!b) return;
    document.getElementById('t-services').checked = true;
    const key = b.dataset.target;
    const id = key==='instagram' ? 'svcInstagram' :
               key==='tiktok' ? 'svcTikTok' : null;
    if(id){ setTimeout(()=>document.getElementById(id).scrollIntoView({behavior:'smooth', block:'start'}), 80); }
  });

  /* ---------- Clientes (solo los que me diste) ---------- */
  const clients = [
    {handle:'@aaronmercury', platform:'Instagram', avatar:''},
    {handle:'@televisadigital', platform:'Instagram', avatar:''},
    {handle:'@joscanela', platform:'Instagram', avatar:''},
    {handle:'@jimenagallegotv', platform:'Instagram', avatar:''},
  ];
  function renderClients(where){
    const host = document.getElementById(where);
    host.innerHTML = clients.map(c=>`
      <div class="client">
        <div class="avatar">
          ${c.avatar ? `<img src="${c.avatar}" alt="${c.handle}">` : `<svg width="36" height="36" viewBox="0 0 24 24" style="transform:scale(.9)"><use href="#lg-ig"/></svg>`}
          <span class="badge-ig" title="Verificado">✓</span>
        </div>
        <div class="handle">${c.handle}</div>
        <div class="platform">${c.platform}</div>
        <div class="right-logo"><svg width="18" height="18"><use href="#lg-ig"/></svg></div>
      </div>
    `).join('');
  }
  renderClients('clientList'); renderClients('clientList2');

  /* ---------- Quick automation ---------- */
  document.getElementById('quickBtn').addEventListener('click', ()=>{
    const v = (document.getElementById('quickInput').value || '').trim();
    if(!v) return toast('Escribe qué automatizar');
    toast('Automatizando: '+v);
    document.getElementById('quickInput').value='';
  });

  /* ---------- Servicios: back & deep-link ---------- */
  document.getElementById('backHome').addEventListener('click', ()=>{ document.getElementById('t-home').checked = true; });
  // Gesture: deslizar desde el borde izquierdo para "atrás"
  let touchStartX=null; 
  window.addEventListener('touchstart',e=>{ if(e.touches[0].clientX<24) touchStartX=e.touches[0].clientX; },{passive:true});
  window.addEventListener('touchend',e=>{ if(touchStartX!==null){ const dx = (e.changedTouches[0].clientX - touchStartX); if(dx>60){ history.back(); } touchStartX=null; } },{passive:true});

  /* ---------- Farm ---------- */
  const farmGrid = document.getElementById('farmGrid');
  const denseToggle = document.getElementById('denseToggle');
  const defaultDevices = [
    {id:'dev1',name:'iPhone 14 Pro',os:'iOS',ip:'10.0.0.8'},
    {id:'dev2',name:'Galaxy S23',os:'Android',ip:'10.0.0.9'},
    {id:'dev3',name:'iPhone 13',os:'iOS',ip:'10.0.0.10'},
    {id:'dev4',name:'Pixel 8',os:'Android',ip:'10.0.0.11'}
  ];
  denseToggle.checked = localStorage.getItem('krv_dense')==='1';
  if(denseToggle.checked){ document.documentElement.style.setProperty('--r','12px'); }
  denseToggle.addEventListener('change',()=>{
    localStorage.setItem('krv_dense', denseToggle.checked?'1':'0');
    document.documentElement.style.setProperty('--r', denseToggle.checked? '12px':'16px');
    renderFarm();
  });
  function renderFarm(){
    farmGrid.innerHTML = defaultDevices.map(d=>{
      const src = localStorage.getItem('stream:'+d.id) || '';
      return `
        <div class="dev">
          <div class="dev-head">
            <div><strong>${d.name}</strong> · ${d.os}</div>
            <div class="chips">
              <span class="chip" data-live="${src?1:0}">${src?'Live':'Idle'}</span>
              <span class="chip">${d.ip}</span>
            </div>
          </div>
          <div class="screen">
            ${src ? (
              src.endsWith('.mjpg')||src.endsWith('.mjpeg') ? `<img src="${src}">` :
              src.endsWith('.m3u8') ? `<video src="${src}" autoplay muted playsinline></video>` :
              `<iframe src="${src}" allow="autoplay; encrypted-media" allowfullscreen></iframe>`
            ) : '<div class="placeholder"></div>'}
          </div>
          <div class="dev-actions">
            <button class="btn-outline" data-set="${d.id}">Asignar stream</button>
            <button class="btn-outline" data-clear="${d.id}">Limpiar</button>
          </div>
        </div>
      `;
    }).join('');
  }
  renderFarm();
  farmGrid.addEventListener('click',(e)=>{
    const b=e.target.closest('button'); if(!b) return;
    if(b.dataset.set){
      const id=b.dataset.set; const cur=localStorage.getItem('stream:'+id)||'';
      const url=prompt('URL stream (HLS .m3u8, MJPEG .mjpg, o https):',cur);
      if(url!==null){ localStorage.setItem('stream:'+id,url.trim()); renderFarm(); toast('Stream actualizado'); }
    }
    if(b.dataset.clear){
      const id=b.dataset.clear; localStorage.removeItem('stream:'+id); renderFarm(); toast('Stream limpiado');
    }
  });

  /* ---------- UI helpers ---------- */
  function toast(msg){
    const el=document.createElement('div'); el.textContent=msg;
    el.style.cssText=`position:fixed;left:50%;top:12px;transform:translateX(-50%);z-index:9999;background:#111827;color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12)`;
    document.body.appendChild(el); setTimeout(()=>el.remove(),2200);
  }

  /* ---------- Responsive hint: si pantalla alta, añade una fila más de redes ---------- */
  const tall = window.matchMedia('(min-height: 780px)');
  tall.addEventListener?.('change',()=>{/* grid ya es fluida */});
})();
</script>
</body>
</html>