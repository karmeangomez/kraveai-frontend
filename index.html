<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
<title>KraveAI — Panel</title>
<meta name="theme-color" content="#0b0d12" />
<style>
/* ====== Tokens ====== */
:root{
  --bg:#0b0f14; --elev:#0f141d; --card:#101826; --text:#eaf0f7; --muted:#91a0b5; --line:#1f2a3a;
  --ok:#22c55e; --err:#ef4444;
  --brand1:#7c5cff; --brand2:#00d3c2;
  --r:16px; --gap:12px; --shadow:0 14px 40px rgba(0,0,0,.28);
}
:root[data-theme="light"]{
  --bg:#f7f9fc; --elev:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#64748b; --line:#e5eaf2; --shadow:0 14px 36px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--text);
  font:15px/1.4 system-ui,-apple-system,"SF Pro Text",Inter,Roboto;
}
.app{min-height:100svh;display:grid;grid-template-rows:auto 1fr auto}

/* ====== Topbar ====== */
.top{
  position:sticky;top:0;z-index:20;
  display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;
  padding:10px max(14px,env(safe-area-inset-left)) 8px max(14px,env(safe-area-inset-right));
  border-bottom:1px solid var(--line);
  background:color-mix(in oklab,var(--elev) 92%, transparent);
  backdrop-filter:blur(14px) saturate(1.05);
}
.brand{display:flex;align-items:center;gap:10px}
.badge{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand1),var(--brand2))}
.word{font-weight:900;letter-spacing:.14em}
.status{justify-self:center;color:var(--muted);display:flex;align-items:center;gap:8px}
.status .dot{width:8px;height:8px;border-radius:50%;background:#8b8b8b}
.toggle{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;border:1px solid var(--line);background:rgba(255,255,255,.04);cursor:pointer}
.sun{display:none}
:root[data-theme="light"] .sun{display:block}
:root[data-theme="light"] .moon{display:none}

/* ====== Bottom nav ====== */
.nav{
  position:sticky;bottom:0;z-index:20;
  display:grid;grid-template-columns:repeat(5,1fr);gap:8px;
  padding:8px max(12px,env(safe-area-inset-left)) calc(8px + env(safe-area-inset-bottom)) max(12px,env(safe-area-inset-right));
  border-top:1px solid var(--line);
  background:color-mix(in oklab,var(--elev) 92%, transparent);
  backdrop-filter:blur(14px) saturate(1.05);
}
.tab{display:flex;gap:6px;flex-direction:column;align-items:center;padding:10px;border-radius:12px;color:var(--muted);border:1px solid transparent;user-select:none;cursor:pointer}
.tab svg{width:18px;height:18px}
input[name="tab"]{position:absolute;opacity:0;pointer-events:none}
#t-home:checked ~ .app .nav label[for="t-home"],
#t-svcs:checked ~ .app .nav label[for="t-svcs"],
#t-clients:checked ~ .app .nav label[for="t-clients"],
#t-farm:checked ~ .app .nav label[for="t-farm"],
#t-acc:checked ~ .app .nav label[for="t-acc"]{color:var(--text);background:rgba(255,255,255,.06);border-color:var(--line)}

/* ====== Main / views ====== */
.main{
  height:calc(100svh - 56px - 64px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  padding:12px max(14px,env(safe-area-inset-left)) 12px max(14px,env(safe-area-inset-right));
  overflow:hidden; /* Sin scroll global */
}
.view{display:none;height:100%;animation:fade .15s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
#t-home:checked ~ .app .view[data-tab="home"],
#t-svcs:checked ~ .app .view[data-tab="svcs"],
#t-clients:checked ~ .app .view[data-tab="clients"],
#t-farm:checked ~ .app .view[data-tab="farm"],
#t-acc:checked ~ .app .view[data-tab="acc"]{display:block}

/* ====== Shared UI ====== */
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow)}
.section{display:grid;gap:10px}
.h1{font-size:1.64rem;font-weight:900}
.hint{color:var(--muted);font-size:.9rem}

/* ====== Home ====== */
.home-wrap{display:grid;grid-template-columns:1fr;gap:12px;height:100%}
@media (min-width:760px){ .home-wrap{grid-template-columns:1.2fr .8fr} }

.badge-creator{
  position:fixed;left:50%;bottom:calc(58px + env(safe-area-inset-bottom));
  transform:translateX(-50%);
  background:linear-gradient(180deg, color-mix(in oklab, var(--elev) 96%, transparent), color-mix(in oklab, var(--elev) 98%, transparent));
  border:1px solid var(--line);border-radius:999px;padding:8px 14px;
  box-shadow:0 0 18px rgba(124,92,255,.55), 0 0 28px rgba(0,211,194,.38);
  animation:breath 3.8s ease-in-out infinite; font-weight:700; z-index:25;
}
@keyframes breath{50%{transform:translateX(-50%) scale(1.04)}}

/* redes grid */
.social-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.s-tile{display:flex;align-items:center;gap:8px;padding:12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.03);cursor:pointer}
.s-ico{width:28px;height:28px;display:grid;place-items:center;border-radius:8px;background:rgba(255,255,255,.06);border:1px solid var(--line)}
.s-ico svg{width:18px;height:18px}
.s-name{font-weight:800}

/* quick action */
.quick{display:flex;gap:8px;align-items:center;padding:10px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04)}
.quick input{flex:1;border:0;background:transparent;color:var(--text);outline:none}

/* clientes (scroll SOLO aquí) */
.clients-box{display:grid;gap:10px;height:100%}
.clients-list{overflow:auto;min-height:0;display:grid;gap:8px;padding-right:2px}
.client{display:flex;align-items:center;gap:10px;padding:10px;border:1px solid var(--line);border-radius:14px;background:rgba(255,255,255,.03)}
.avatar{width:34px;height:34px;border-radius:50%;overflow:hidden;display:grid;place-items:center;background:#111}
.avatar img{width:100%;height:100%;object-fit:cover}
.badge-ig{width:18px;height:18px}

/* ====== Services ====== */
.svcs-wrap{display:grid;grid-template-columns:1fr;gap:12px;height:100%}
@media (min-width:760px){ .svcs-wrap{grid-template-columns:280px 1fr} }
.net-list{display:grid;gap:8px;overflow:auto;min-height:0}
.net-item{padding:10px;border-radius:12px;border:1px solid var(--line);display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);cursor:pointer}
.net-item.active{outline:2px solid color-mix(in oklab, var(--brand1) 55%, var(--brand2) 45%);background:rgba(124,92,255,.08)}
.svc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;overflow:auto;min-height:0}
.svc-tile{padding:12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);cursor:pointer;font-weight:800}
.form{display:grid;gap:8px}
.input{display:flex;gap:8px;align-items:center;border:1px solid var(--line);background:rgba(255,255,255,.04);padding:10px;border-radius:12px}
.input input{flex:1;border:0;background:transparent;color:var(--text);outline:none}
.btn{border:1px solid var(--line);padding:10px 14px;border-radius:12px;background:rgba(255,255,255,.04);color:var(--text);font-weight:800;cursor:pointer}
.btn-primary{border:0;background:linear-gradient(135deg,var(--brand1),var(--brand2));color:#0b0f14}

/* ====== Farm (teléfonos) ====== */
.farm-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;overflow:auto;min-height:0}
.phone{padding:12px}
.screen{height:420px;border-radius:32px;border:1px solid var(--line);background:#000;position:relative;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.35)}
/* notch simple */
.screen:before{content:"";position:absolute;top:10px;left:50%;transform:translateX(-50%);width:120px;height:22px;border-radius:12px;background:#000}
.screen iframe,.screen img,.screen video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:32px}
.dev-head{display:flex;justify-content:space-between;align-items:center;font-weight:800;margin-bottom:8px}

/* ====== Accounts ====== */
.grid{display:grid;gap:10px}
.search{display:flex;gap:8px}
.small{font-size:.86rem;color:var(--muted)}
/* ====== Verified badge (Instagram real-ish) ====== */
svg#ig-check{width:18px;height:18px}
</style>
</head>
<body>

<!-- Tabs (sin JS) -->
<input type="radio" id="t-home"   name="tab" checked>
<input type="radio" id="t-svcs"   name="tab">
<input type="radio" id="t-clients" name="tab">
<input type="radio" id="t-farm"   name="tab">
<input type="radio" id="t-acc"    name="tab">

<!-- Icon sprite -->
<svg width="0" height="0" aria-hidden="true" style="position:absolute">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#7c5cff"/><stop offset="100%" stop-color="#00d3c2"/>
    </linearGradient>
    <symbol id="ico-home" viewBox="0 0 24 24"><path d="M3 10l9-7 9 7v9a2 2 0 0 1-2 2h-4v-7H9v7H5a2 2 0 0 1-2-2z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-tools" viewBox="0 0 24 24"><path d="M3 21l6-6M7 3l3 3-2 2 6 6 2-2 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
    <symbol id="ico-users" viewBox="0 0 24 24"><path d="M7 14a4 4 0 1 1 4-4M3 21a6 6 0 0 1 12 0" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-dev" viewBox="0 0 24 24"><rect x="3" y="5" width="14" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><rect x="19" y="9" width="2" height="8" rx="1" fill="currentColor"/></symbol>
    <symbol id="ico-lock" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="9" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M7 11V8a5 5 0 0 1 10 0v3" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 1v2m0 18v2M4.2 4.2l1.4 1.4m12.8 12.8l1.4 1.4M1 12h2m18 0h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="ico-moon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36A5.4 5.4 0 0 1 16.5 13 5.4 5.4 0 0 1 13.4 3.2 9 9 0 0 0 12 3z" fill="none" stroke="currentColor" stroke-width="2"/></symbol>

    <!-- Redes (vectores limpios que respetan light/dark) -->
    <symbol id="logo-instagram" viewBox="0 0 24 24">
      <rect x="3" y="3" width="18" height="18" rx="5" fill="none" stroke="#E1306C" stroke-width="2"/>
      <circle cx="12" cy="12" r="4" fill="none" stroke="#E1306C" stroke-width="2"/>
      <circle cx="17.2" cy="6.8" r="1.2" fill="#E1306C"/>
    </symbol>
    <symbol id="logo-tiktok" viewBox="0 0 24 24">
      <!-- trazos dobles (cian/rosa) + negro adaptado -->
      <path d="M10 5v9.2a3.8 3.8 0 1 1-2.8 6.2" fill="none" stroke="currentColor" stroke-width="2"/>
      <path d="M14 5c.5 2.6 2.4 4.1 5 4.3" fill="none" stroke="#ff0050" stroke-width="2"/>
      <path d="M10 7a5 5 0 0 0-5 5" fill="none" stroke="#69C9D0" stroke-width="2"/>
    </symbol>
    <symbol id="logo-youtube" viewBox="0 0 24 24"><rect x="3" y="6" width="18" height="12" rx="3" fill="#FF0000"/><path d="M10 9l6 3-6 3z" fill="#fff"/></symbol>
    <symbol id="logo-threads" viewBox="0 0 24 24"><path d="M6 12c0-4 3-7 6-7s6 3 6 7-3 7-6 7c-2 0-3.5-1-3.5-2.5S9 14 12 14c2.5 0 3.8-1.2 3.8-3S14.5 8 12 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
    <symbol id="logo-x" viewBox="0 0 24 24"><path d="M4 4l16 16M20 4L4 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
    <symbol id="logo-facebook" viewBox="0 0 24 24"><path d="M14 8h3V5h-3c-2 0-3 .9-3 3v2H8v3h3v6h3v-6h3l1-3h-4V8c0-.7.3-1 1-1z" fill="#1877F2"/></symbol>
    <symbol id="logo-linkedin" viewBox="0 0 24 24"><rect x="3" y="8" width="4" height="12" fill="#0A66C2"/><circle cx="5" cy="5.5" r="2" fill="#0A66C2"/><rect x="9" y="8" width="12" height="12" rx="2" fill="none" stroke="#0A66C2" stroke-width="2"/></symbol>
    <symbol id="logo-telegram" viewBox="0 0 24 24"><path d="M21 3L3 11l6 2 2 6 3-4 4-10z" fill="#0088cc"/></symbol>
    <symbol id="logo-whatsapp" viewBox="0 0 24 24"><path d="M12 3a9 9 0 0 1 0 18 9.4 9.4 0 0 1-4-.9L5 21l.9-3.1A9.4 9.4 0 0 1 3 12 9 9 0 0 1 12 3z" fill="#25D366"/><path d="M9 8c0 3 3 6 5 6l1-1" stroke="#fff" stroke-width="2"/></symbol>
    <symbol id="logo-spotify" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#1DB954"/><path d="M7 10c3-1 7-1 10 1M7 13c3-1 6-1 9 1M7 16c2-.5 4-.5 6 .5" stroke="#fff" stroke-width="2" fill="none"/></symbol>

    <!-- IG verified “real” (círculo azul con check blanco) -->
    <symbol id="ig-verified" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" fill="#0095F6"/>
      <path d="M8.5 12.5l2.2 2.2 4.8-5.2" fill="none" stroke="#fff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
  </defs>
</svg>

<div class="app" id="app">
  <!-- Topbar -->
  <header class="top">
    <div class="brand">
      <div class="badge"></div>
      <div class="word">KraveAI</div>
    </div>
    <div class="status"><span class="dot" id="dot"></span><small id="stat">Conectando…</small></div>
    <button class="toggle" id="theme">
      <svg class="sun" width="20" height="20"><use href="#ico-sun"/></svg>
      <svg class="moon" width="20" height="20"><use href="#ico-moon"/></svg>
    </button>
  </header>

  <!-- Main -->
  <main class="main">
    <!-- HOME -->
    <section class="view" data-tab="home">
      <div class="home-wrap">
        <div class="section">
          <div>
            <div class="h1">Redes sociales</div>
            <div class="hint">Domina todas tus redes con IA</div>
          </div>

          <div class="card" style="padding:12px">
            <div class="hint" style="margin-bottom:8px">Redes sociales</div>
            <div class="social-grid" id="social-grid"></div>
          </div>

          <div class="card" style="padding:12px">
            <div class="hint" style="margin-bottom:8px">Acciones rápidas</div>
            <div class="quick">
              <span>＋</span>
              <input id="quick" placeholder="Pega una URL o escribe una acción">
              <button class="btn btn-primary" id="quick-run">Enviar</button>
            </div>
          </div>
        </div>

        <div class="section clients-box">
          <div>
            <div style="font-weight:900">Clientes recientes</div>
            <div class="hint">Cuentas verificadas en Instagram</div>
          </div>
          <div class="card clients-list" id="clients-list" style="padding:10px"></div>
        </div>
      </div>
    </section>

    <!-- SERVICES -->
    <section class="view" data-tab="svcs">
      <div class="svcs-wrap">
        <div class="card" style="padding:12px;display:grid;gap:8px">
          <div style="font-weight:900">Redes</div>
          <div class="net-list" id="net-list"></div>
        </div>

        <div class="card" style="padding:12px;display:grid;gap:10px;min-width:0">
          <div>
            <div id="svcs-title" style="font-weight:900">Servicios</div>
            <div class="hint" id="svcs-hint">Selecciona una red</div>
          </div>
          <div class="svc-grid" id="svc-grid"></div>

          <!-- Panel de detalle (ejemplo: Instagram → Comentarios) -->
          <div id="svc-detail" class="card" style="display:none;padding:12px">
            <div style="font-weight:900" id="svc-detail-title">Detalle</div>
            <div class="form" id="svc-form"></div>
            <div class="small" id="svc-status">—</div>
          </div>
        </div>
      </div>
    </section>

    <!-- CLIENTS full -->
    <section class="view" data-tab="clients">
      <div class="card" style="padding:12px;height:100%;display:grid;grid-template-rows:auto 1fr;gap:8px">
        <div>
          <div style="font-weight:900">Clientes recientes</div>
          <div class="hint">Instagram</div>
        </div>
        <div class="clients-list" id="clients-full"></div>
      </div>
    </section>

    <!-- FARM -->
    <section class="view" data-tab="farm">
      <div class="card" style="padding:12px;height:100%;display:grid;grid-template-rows:auto 1fr;gap:8px">
        <div>
          <div style="font-weight:900">Device Farm</div>
          <div class="hint">Streams: HLS .m3u8, MJPEG .mjpg o visor https (se guarda en localStorage).</div>
        </div>
        <div class="farm-grid" id="farm-grid"></div>
      </div>
    </section>

    <!-- ACCOUNTS -->
    <section class="view" data-tab="acc">
      <div class="grid" style="height:100%;grid-template-rows:auto auto 1fr;gap:12px">
        <div class="card" style="padding:12px">
          <div class="hint">Sesión</div>
          <div class="grid" style="grid-template-columns:1fr 1fr;gap:10px">
            <div class="input" style="grid-column:1/-1"><span>@</span><input id="login-u" placeholder="Usuario"></div>
            <div class="input" style="grid-column:1/-1"><span>🔒</span><input id="login-p" type="password" placeholder="Contraseña"></div>
            <button class="btn btn-primary" id="login-do">Iniciar sesión</button>
            <button class="btn" id="logout-do">Cerrar sesión</button>
          </div>
          <div class="small" id="session-sub">Verificando…</div>
        </div>

        <div class="card" style="padding:12px">
          <div style="font-weight:900;margin-bottom:6px">Agregar cuenta manual</div>
          <div class="grid" style="grid-template-columns:1fr 1fr;gap:10px">
            <div class="input" style="grid-column:1/-1"><span>@</span><input id="acc-u" placeholder="@usuario"></div>
            <div class="input" style="grid-column:1/-1"><span>🔒</span><input id="acc-p" type="password" placeholder="••••••••"></div>
            <button class="btn btn-primary" id="acc-add">Guardar cuenta</button>
          </div>
        </div>

        <div class="card" style="padding:12px;display:grid;grid-template-rows:auto auto 1fr;gap:8px">
          <div style="font-weight:900">Buscar usuario (Instagram)</div>
          <div class="search">
            <div class="input" style="flex:1"><span>@</span><input id="ig-search" placeholder="@usuario"></div>
            <button class="btn" id="ig-do">Buscar</button>
          </div>
          <div id="ig-result" class="small" style="overflow:auto"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer nav -->
  <nav class="nav">
    <label class="tab" for="t-home"><svg><use href="#ico-home"/></svg><small>Inicio</small></label>
    <label class="tab" for="t-svcs"><svg><use href="#ico-tools"/></svg><small>Servicios</small></label>
    <label class="tab" for="t-clients"><svg><use href="#ico-users"/></svg><small>Clientes</small></label>
    <label class="tab" for="t-farm"><svg><use href="#ico-dev"/></svg><small>Farm</small></label>
    <label class="tab" for="t-acc"><svg><use href="#ico-lock"/></svg><small>Cuentas</small></label>
  </nav>
</div>

<!-- Creator badge (centrado, respirando) -->
<div class="badge-creator" id="creator">Created by Karmean Gómez</div>

<script>
(function(){
  const API_URL = "https://api.kraveapi.xyz";

  /* Theme */
  const root=document.documentElement;
  root.setAttribute('data-theme', localStorage.getItem('theme')||'dark');
  document.getElementById('theme').onclick=()=>{
    const next=root.getAttribute('data-theme')==='dark'?'light':'dark';
    root.setAttribute('data-theme',next); localStorage.setItem('theme',next);
  };

  /* Health */
  const dot=document.getElementById('dot'), stat=document.getElementById('stat');
  async function health(){ try{const r=await fetch(`${API_URL}/health`,{credentials:'include'}); if(r.ok){dot.style.background='var(--ok)'; stat.textContent='Conectado';} else throw 0;}catch{dot.style.background='var(--err)'; stat.textContent='Sin conexión';} }
  health(); setInterval(health,120000);

  /* Toast */
  function toast(msg,err){const el=document.createElement('div'); el.textContent=msg; el.style.cssText=`position:fixed;left:50%;top:12px;transform:translateX(-50%);z-index:9999;background:${err?'#ef4444':'#1f2937'};color:#fff;padding:8px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15)`; document.body.appendChild(el); setTimeout(()=>el.remove(),2200);}

  /* Redes */
  const networks=[
    {k:'instagram', name:'Instagram', ico:'#logo-instagram', caps:['Comentarios','Likes','Seguidores','Vistas']},
    {k:'tiktok',    name:'TikTok',    ico:'#logo-tiktok',    caps:['Vistas','Likes','Seguidores']},
    {k:'youtube',   name:'YouTube',   ico:'#logo-youtube',   caps:['Vistas','Likes','Comentarios']},
    {k:'threads',   name:'Threads',   ico:'#logo-threads',   caps:['Likes','Respuestas']},
    {k:'x',         name:'X',         ico:'#logo-x',         caps:['Likes','Reposts','Seguidores']},
    {k:'facebook',  name:'Facebook',  ico:'#logo-facebook',  caps:['Reacciones','Comentarios']},
    {k:'linkedin',  name:'LinkedIn',  ico:'#logo-linkedin',  caps:['Reacciones','Comentarios','Conexiones']},
    {k:'spotify',   name:'Spotify',   ico:'#logo-spotify',   caps:['Streams','Saves']},
    {k:'telegram',  name:'Telegram',  ico:'#logo-telegram',  caps:['Mensajes','Miembros']},
    {k:'whatsapp',  name:'WhatsApp',  ico:'#logo-whatsapp',  caps:['Mensajes']}
  ];

  const socialGrid=document.getElementById('social-grid');
  socialGrid.innerHTML = networks.map(n => `
    <button class="s-tile" data-k="${n.k}">
      <span class="s-ico"><svg><use href="${n.ico}"/></svg></span>
      <span class="s-name">${n.name}</span>
    </button>`).join('');
  socialGrid.addEventListener('click', e=>{
    const btn=e.target.closest('.s-tile'); if(!btn) return;
    const k=btn.dataset.k;
    document.getElementById('t-svcs').checked=true;
    selectNetwork(k);
  });

  /* Servicios */
  const netList=document.getElementById('net-list');
  netList.innerHTML = networks.map(n=>`
    <div class="net-item" data-k="${n.k}">
      <span class="s-ico"><svg><use href="${n.ico}"/></svg></span>
      <div style="font-weight:800">${n.name}</div>
    </div>`).join('');
  netList.addEventListener('click', e=>{
    const it=e.target.closest('.net-item'); if(!it) return; selectNetwork(it.dataset.k);
  });

  const svcGrid=document.getElementById('svc-grid');
  const svcsTitle=document.getElementById('svcs-title');
  const svcsHint=document.getElementById('svcs-hint');
  const detail=document.getElementById('svc-detail');
  const formBox=document.getElementById('svc-form');
  const formTitle=document.getElementById('svc-detail-title');
  const formStatus=document.getElementById('svc-status');

  function selectNetwork(k){
    document.querySelectorAll('.net-item').forEach(n=>n.classList.toggle('active', n.dataset.k===k));
    const meta=networks.find(n=>n.k===k);
    svcsTitle.textContent = `Servicios — ${meta.name}`;
    svcsHint.textContent  = 'Elige un servicio';
    detail.style.display='none';
    svcGrid.innerHTML = meta.caps.map(c=>`<button class="svc-tile" data-k="${k}" data-s="${c.toLowerCase()}">${c}</button>`).join('');
  }
  svcGrid.addEventListener('click', e=>{
    const tile=e.target.closest('.svc-tile'); if(!tile) return;
    const net=tile.dataset.k, svc=tile.dataset.s;
    openService(net, svc);
  });

  function openService(net, svc){
    formStatus.textContent='—';
    formBox.innerHTML='';
    formTitle.textContent=`${net.charAt(0).toUpperCase()+net.slice(1)} — ${svc.charAt(0).toUpperCase()+svc.slice(1)}`;

    // Implementado completo: Instagram → comentarios
    if(net==='instagram' && svc==='comentarios'){
      formBox.innerHTML = `
        <div class="input"><span>🔗</span><input id="ig-url" placeholder="URL del post (https://www.instagram.com/p/...)"></div>
        <div class="input"><span>#</span><input id="ig-cant" type="number" min="1" max="100" value="30" placeholder="Cantidad"></div>
        <div class="input"><span>🎛️</span><input id="ig-modo" value="auto" list="modos" placeholder="Modo"></div>
        <datalist id="modos"><option value="auto"><option value="personalizado"><option value="manual"></datalist>
        <div class="input"><span>🧑‍💼</span><input id="ig-apodo" placeholder="Apodo (opcional)"></div>
        <div class="input"><span>🎯</span><input id="ig-estilo" placeholder="Estilo (fitness, sexy, etc)"></div>
        <div class="input"><span>🏷️</span><input id="ig-act" placeholder="Actividad (entrenador, etc)"></div>
        <div class="input"><span>📝</span><input id="ig-ej" placeholder="Ejemplos (uno por línea)"></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-primary" id="ig-send">Lanzar</button>
          <button class="btn" id="ig-cancel">Cancelar</button>
        </div>`;
      detail.style.display='block';
      document.getElementById('ig-send').onclick=async ()=>{
        const payload={
          url:document.getElementById('ig-url').value.trim(),
          cantidad:+document.getElementById('ig-cant').value||30,
          modo:document.getElementById('ig-modo').value.trim()||'auto',
          apodo:document.getElementById('ig-apodo').value.trim(),
          estilo:document.getElementById('ig-estilo').value.trim(),
          actividad:document.getElementById('ig-act').value.trim(),
          ejemplos:document.getElementById('ig-ej').value.trim()
        };
        if(!payload.url){ toast('Falta URL',true); return;}
        try{
          formStatus.textContent='Enviando…';
          const r=await fetch(`${API_URL}/instagram/comentarios`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(payload)});
          const d=await r.json().catch(()=>({}));
          if(!r.ok) throw new Error(d.mensaje||'Error en comentarios');
          formStatus.textContent='✅ Comentarios en proceso'; toast('Comentarios lanzados');
        }catch(err){ formStatus.textContent='❌ '+err.message; toast(err.message,true); }
      };
      document.getElementById('ig-cancel').onclick=()=>{ detail.style.display='none'; };
      return;
    }

    // Otros servicios (plantilla genérica bonita)
    formBox.innerHTML = `
      <div class="input"><span>🔗</span><input id="gen-url" placeholder="URL o identificador"></div>
      <div class="input"><span>#</span><input id="gen-q" type="number" min="1" step="1" placeholder="Cantidad"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn btn-primary" id="gen-send">Enviar</button>
      </div>`;
    detail.style.display='block';
    document.getElementById('gen-send').onclick=()=>toast('Servicio pendiente de cablear');
  }

  /* Quick */
  document.getElementById('quick-run').onclick=()=>{
    const v=(document.getElementById('quick').value||'').trim();
    if(!v){toast('Escribe algo',true);return}
    toast('Procesando: '+v);
    document.getElementById('quick').value='';
  };

  /* Clientes (avatar fallback + check real) */
  const clients=[
    {u:'aaronmercury', name:'Instagram', img:'', verified:true},
    {u:'televisadigital', name:'Instagram', img:'', verified:true},
    {u:'joscanela', name:'Instagram', img:'', verified:true},
    {u:'jimenagallegotv', name:'Instagram', img:'', verified:true},
  ];
  function clientRow(c){
    return `<div class="client">
      <div class="avatar">${c.img?`<img src="${c.img}">`:`<svg width="20" height="20"><use href="#logo-instagram"/></svg>`}</div>
      <div style="font-weight:800">@${c.u}</div>
      ${c.verified?`<svg class="badge-ig"><use href="#ig-verified"/></svg>`:''}
      <div class="small" style="margin-left:auto">Instagram</div>
    </div>`;
  }
  const cl1=document.getElementById('clients-list');
  const cl2=document.getElementById('clients-full');
  cl1.innerHTML = clients.map(clientRow).join('');
  cl2.innerHTML = clients.map(clientRow).join('');

  /* Farm (teléfonos) */
  const devices=[
    {id:'d1',name:'iPhone 14 Pro',os:'iOS',ip:'10.0.0.8'},
    {id:'d2',name:'Galaxy S23',os:'Android',ip:'10.0.0.9'},
    {id:'d3',name:'iPhone 13',os:'iOS',ip:'10.0.0.10'},
    {id:'d4',name:'Pixel 8',os:'Android',ip:'10.0.0.11'},
    {id:'d5',name:'iPhone 12 mini',os:'iOS',ip:'10.0.0.12'},
    {id:'d6',name:'Galaxy A54',os:'Android',ip:'10.0.0.13'},
  ];
  const farm=document.getElementById('farm-grid');
  function renderFarm(){
    farm.innerHTML = devices.map(d=>{
      const src=localStorage.getItem('stream:'+d.id)||'';
      return `<div class="card phone">
        <div class="dev-head"><div>${d.name} · ${d.os}</div><div class="small">${d.ip}</div></div>
        <div class="screen">${src?(src.endsWith('.mjpg')||src.endsWith('.mjpeg')?`<img src="${src}">`:src.endsWith('.m3u8')?`<video src="${src}" autoplay muted playsinline></video>`:`<iframe src="${src}" allow="autoplay; encrypted-media"></iframe>`):''}</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn btn-primary" data-set="${d.id}">Asignar stream</button>
          <button class="btn" data-clear="${d.id}">Limpiar</button>
        </div>
      </div>`;
    }).join('');
  }
  renderFarm();
  farm.onclick=(e)=>{
    const b=e.target.closest('button'); if(!b) return;
    if(b.dataset.set){ const id=b.dataset.set; const cur=localStorage.getItem('stream:'+id)||''; const url=prompt('URL stream (.m3u8 / .mjpg / https):',cur)||''; localStorage.setItem('stream:'+id,url.trim()); renderFarm(); toast('Stream guardado'); }
    if(b.dataset.clear){ localStorage.removeItem('stream:'+b.dataset.clear); renderFarm(); toast('Stream limpiado'); }
  };

  /* Accounts */
  async function session(){ try{ const r=await fetch(`${API_URL}/estado-sesion`,{credentials:'include'}); const d=await r.json(); document.getElementById('session-sub').textContent=(d.status==='activo')?`Sesión activa como @${d.usuario}`:'No hay sesión activa'; }catch{ document.getElementById('session-sub').textContent='Error al verificar sesión'; } }
  session();
  document.getElementById('login-do').onclick=async ()=>{
    const u=document.getElementById('login-u').value.trim().replace('@',''); const p=document.getElementById('login-p').value.trim();
    if(!u||!p) return toast('Completa usuario y contraseña',true);
    try{ const r=await fetch(`${API_URL}/iniciar-sesion`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({usuario:u,contrasena:p})}); const d=await r.json(); if(!d.exito) throw new Error(d.mensaje||'Error'); toast('Sesión iniciada'); session(); }catch(err){ toast(err.message,true) }
  };
  document.getElementById('logout-do').onclick=async ()=>{ try{ const r=await fetch(`${API_URL}/cerrar-sesion`,{credentials:'include'}); const d=await r.json(); if(!d.exito) throw new Error(d.mensaje||'Error'); toast('Sesión cerrada'); session(); }catch(err){ toast(err.message,true) } };
  document.getElementById('acc-add').onclick=()=>toast('Alta manual lista (conecta tu endpoint si aplica)');

  /* IG Search (si no hay endpoint devuelve demo) */
  document.getElementById('ig-do').onclick=async ()=>{
    const v=document.getElementById('ig-search').value.trim().replace('@','');
    if(!v) return;
    const box=document.getElementById('ig-result'); box.textContent='Buscando…';
    try{
      const r=await fetch(`${API_URL}/instagram/userinfo?u=${encodeURIComponent(v)}`,{credentials:'include'});
      const d=await r.json();
      if(!r.ok) throw 0;
      box.innerHTML = `<div class="client">${d.avatar?`<div class="avatar"><img src="${d.avatar}"></div>`:`<div class="avatar"><svg width="20" height="20"><use href="#logo-instagram"/></svg></div>`}
        <div style="font-weight:800">@${d.username}</div>
        ${d.verified?`<svg class="badge-ig"><use href="#ig-verified"/></svg>`:''}
        <div class="small" style="margin-left:auto">${d.fullname||''}</div>
      </div>`;
    }catch{
      box.innerHTML = `<div class="client"><div class="avatar"><svg width="20" height="20"><use href="#logo-instagram"/></svg></div><div style="font-weight:800">@${v}</div><svg class="badge-ig"><use href="#ig-verified"/></svg><div class="small" style="margin-left:auto">Demo (sin endpoint)</div></div>`;
    }
  };

})();
</script>
</body>
</html>