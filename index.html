<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>KraveAI</title>
<link rel="manifest" href="/manifest.webmanifest"/>
<meta name="theme-color" content="#0b1220"/>
<link rel="icon" href="/icons/robot-192.png" sizes="192x192"/>
<link rel="apple-touch-icon" href="/icons/robot-192.png"/>

<style>
:root{
  --bg:#0f1419;--card:#141a21;--card-2:#11171d;--muted:#8ea0b2;--text:#e9eef5;--line:#1f2833;
  --brand:#19c2ff;--accent:#0077ff;--chip:#1b2430;--chip-text:#dfe7ef;--ok:#25d366;--danger:#ff2d2d;
  --gold1:#1b1a14;--gold2:#3b3523;--gold3:#c5a34a;
}
*{box-sizing:border-box} html,body{height:100%;margin:0}
body{background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;overflow-x:hidden}
a{color:inherit;text-decoration:none}
.hidden{display:none!important}
.btn{background:var(--card);color:var(--text);border:1px solid var(--line);padding:10px 14px;border-radius:12px;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--brand));border-color:transparent;color:#fff}
.input{width:100%;background:var(--card);color:var(--text);border:1px solid var(--line);padding:12px 14px;border-radius:14px;outline:none}

/* Header */
.topbar{position:sticky;top:0;z-index:80;background:var(--card-2);border-bottom:1px solid var(--line);
  padding:14px 14px;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:10px;font-weight:800}
.robot{width:28px;height:28px}
.pill{font-size:12px;color:var(--muted);display:flex;gap:6px;align-items:center}
.dot{width:8px;height:8px;border-radius:999px;background:#e0565b}

/* Layout */
.wrap{min-height:100vh;padding:10px 14px 80px}
h1{margin:8px 0 0;font-size:28px;text-shadow:0 0 8px var(--brand),0 0 16px var(--accent)}
.section-title{margin:22px 0 10px;font-weight:800;display:flex;align-items:center;gap:8px}

/* F1 button */
#f1Btn{position:fixed;left:12px;top:66px;z-index:85;background:linear-gradient(135deg,#ff2a2a,#b40000);
  border:1px solid #8a1010;color:#fff;padding:10px 16px;border-radius:999px;font-weight:900;
  box-shadow:0 0 28px rgba(255,0,0,.75), inset 0 0 12px rgba(255,0,0,.55);animation:f1Glow 2s ease-in-out infinite;cursor:pointer}
#f1Btn span{margin-right:6px} @keyframes f1Glow{0%,100%{box-shadow:0 0 26px rgba(255,0,0,.65), inset 0 0 10px rgba(255,0,0,.5)}50%{box-shadow:0 0 40px rgba(255,40,40,.95), inset 0 0 16px rgba(255,40,40,.85)}}
.f1-burst{position:fixed;width:20px;height:20px;border-radius:999px;background:rgba(255,0,0,.35);pointer-events:none;animation:f1Burst .7s ease-out forwards}
@keyframes f1Burst{0%{transform:scale(0);opacity:.6}100%{transform:scale(42);opacity:0}}

/* Social grid */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media(min-width:760px){.grid{grid-template-columns:repeat(4,1fr)}}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer;min-height:64px}
.logo-wrap{width:28px;height:28px;display:grid;place-items:center}
.title{font-weight:700}
.mu{background:linear-gradient(160deg,var(--gold1),var(--gold2));border-color:#5a5136;position:relative;overflow:hidden}
.mu::after{content:'';position:absolute;inset:0;background:radial-gradient(120px 40px at 85% -20%, rgba(197,163,74,.35), transparent 60%)}
.mu .pill{font-size:11px;border:1px solid #7c6a3a;border-radius:999px;padding:4px 8px}

/* Beast mode */
.beast{background:linear-gradient(45deg,var(--accent),var(--brand));border:1px solid rgba(25,194,255,.5);
  border-radius:18px;padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer;min-height:64px;
  box-shadow:0 0 18px var(--brand), inset 0 0 10px var(--accent);animation:beastGlow 3s ease-in-out infinite}
@keyframes beastGlow{0%,100%{box-shadow:0 0 18px var(--brand), inset 0 0 10px var(--accent)}50%{box-shadow:0 0 30px var(--accent), inset 0 0 16px var(--brand)}}
.beast-hot{background:#ff0000!important;border-color:#ff7a7a!important;box-shadow:0 0 34px #ff2d2d, inset 0 0 22px #ff9a9a!important}
.screen-circle{position:fixed;width:24px;height:24px;border-radius:999px;background:rgba(255,0,0,.35);pointer-events:none;z-index:110;animation:circle-flash .8s ease-out forwards}
@keyframes circle-flash{0%{transform:scale(0);opacity:.35}100%{transform:scale(80);opacity:0}}

/* Recientes (solo aqu√≠ hay scroll) */
.list{display:flex;flex-direction:column;gap:12px;max-height:48vh;overflow:auto}
.row{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;display:flex;align-items:center;gap:12px}
.avatar-wrap{width:40px;height:40px;border-radius:999px;padding:2px;flex:none;display:grid;place-items:center}
.avatar{width:36px;height:36px;border-radius:999px;background:#2a3442}
.ring-ig{background:conic-gradient(#feda75,#fa7e1e,#d62976,#962fbf,#4f5bd5)}
.ring-close{background:conic-gradient(#35c759,#34d058,#35c759)}
.user{font-weight:700;font-size:16px;display:flex;align-items:center;gap:4px}
.grow{flex:1}
.chip{background:var(--chip);color:var(--chip-text);border-radius:999px;padding:6px 10px;font-size:12px}
.dots{border:none;background:transparent;color:var(--muted);font-size:18px;cursor:pointer;padding:6px;line-height:0}
.menu{position:absolute;right:0;top:120%;background:var(--card);border:1px solid var(--line);border-radius:10px;min-width:140px;z-index:40;display:none}
.menu.show{display:block}
.menu button{display:block;width:100%;text-align:left;background:transparent;border:none;color:var(--text);padding:8px 10px;cursor:pointer}

/* Clientes grid (sin ‚Äúcaja‚Äù de scroll) */
.clients-grid{display:grid;gap:12px;max-width:1200px;margin:0 auto;grid-template-columns:repeat(4,1fr)}
@media(max-width:480px){.clients-grid{grid-template-columns:1fr}}
@media(min-width:481px) and (max-width:900px){.clients-grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:901px) and (max-width:1200px){.clients-grid{grid-template-columns:repeat(3,1fr)}}
.client-card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;gap:12px;align-items:center;min-height:90px}
.client-card .avatar-wrap{width:52px;height:52px;padding:3px}
.client-card .avatar{width:46px;height:46px}
.client-title{display:flex;align-items:center;gap:4px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.client-sub,.client-meta{color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.client-meta{font-size:12px}
.ig-verified{width:1.05em;height:1.05em;display:inline-block;vertical-align:-.18em;margin-left:2px}

/* Nav + credit */
.nav{position:fixed;left:0;right:0;bottom:0;z-index:60;background:var(--card-2);border-top:1px solid var(--line);display:flex;gap:10px;padding:12px;justify-content:space-around}
.nav .item{flex:1;text-align:center;padding:12px 10px;border-radius:14px;color:var(--muted);font-size:13.5px;cursor:pointer}
.nav .item.active{color:var(--text);background:rgba(255,255,255,.02);border:1px solid var(--line)}
.credit{position:fixed;left:50%;transform:translateX(-50%);bottom:84px;z-index:90;padding:8px 14px;border-radius:999px;font-size:12px;color:#fff;background:rgba(41,178,255,.12);border:1px solid rgba(41,178,255,.35);box-shadow:0 0 30px 6px rgba(41,178,255,.35), inset 0 0 24px rgba(41,178,255,.25)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:120}
.modal.show{display:flex}
.sheet{width:min(560px,92vw);background:var(--card-2);border:1px solid var(--line);border-radius:16px;padding:16px}
.meta{display:flex;gap:14px;margin-top:6px;color:var(--muted);font-size:12px}
.close{float:right;cursor:pointer;color:var(--muted)}
</style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <svg class="robot" viewBox="0 0 64 64" aria-hidden="true"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#19c2ff"/><stop offset="1" stop-color="#0077ff"/></linearGradient></defs><rect x="2" y="10" width="60" height="44" rx="12" fill="url(#g)"/><rect x="8" y="16" width="48" height="32" rx="8" fill="#0b1220"/><circle cx="22" cy="32" r="6" fill="#19c2ff"/><circle cx="42" cy="32" r="6" fill="#19c2ff"/><rect x="28" y="40" width="8" height="4" rx="2" fill="#19c2ff"/></svg>
    <span>KraveAI</span>
  </div>
  <div class="pill"><span class="dot"></span> <span id="conn">Sin conexi√≥n</span></div>
</header>

<button id="f1Btn"><span>üèéÔ∏è</span>F1</button>

<main class="wrap">
  <!-- Home -->
  <section id="view-home" class="view">
    <h1>Redes sociales</h1>
    <div class="section-title">
      Redes
      <button id="addFromHome" class="btn" style="padding:4px 10px;border-radius:10px">Ôºã</button>
    </div>
    <div class="grid" id="socialGrid"></div>

    <div class="section-title">Clientes recientes</div>
    <div class="list" id="recentList"></div>

    <div style="display:flex;gap:10px;margin-top:14px">
      <input id="aiPrompt" class="input" placeholder="¬øQu√© quieres automatizar hoy?"/>
      <button class="btn primary" onclick="sendAction()">Enviar</button>
    </div>
  </section>

  <!-- Clients -->
  <section id="view-clients" class="view">
    <div class="section-title">Clientes <button id="addClientBtn" class="btn" style="padding:4px 10px;border-radius:10px">Ôºã</button></div>
    <input id="clientSearch" class="input" placeholder="Buscar cliente (@usuario o nombre)" style="margin:8px 0 12px"/>
    <div class="clients-grid" id="clientsGrid"></div>
  </section>

  <!-- Farm -->
  <section id="view-farm" class="view">
    <h1>Device Farm</h1>
    <div class="devices" id="farmGrid"></div>
  </section>

  <!-- Accounts -->
  <section id="view-accounts" class="view">
    <h1>Cuentas</h1>
    <div class="btn" style="border-radius:16px;padding:14px;max-width:560px">
      <h4 style="margin:0 0 8px">Iniciar sesi√≥n</h4>
      <input class="input" placeholder="Usuario" />
      <input class="input" placeholder="Contrase√±a" type="password" style="margin-top:6px"/>
      <div style="display:flex;gap:10px;margin-top:8px">
        <button class="btn primary">Iniciar sesi√≥n</button>
        <button class="btn">Cerrar sesi√≥n</button>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section id="view-network" class="view">
    <h1 id="networkTitle">Servicios</h1>
    <div id="networkSub" class="muted" style="margin-bottom:10px">Selecciona un servicio para esta red</div>
    <div class="clients-grid" id="networkServices"></div>
  </section>
</main>

<div class="credit">Created by Karmean Gomez</div>

<nav class="nav">
  <div class="item" data-go="home">Inicio</div>
  <div class="item" data-go="clients">Clientes</div>
  <div class="item" data-go="farm">Farm</div>
  <div class="item" data-go="accounts">Cuentas</div>
</nav>

<!-- Modal ficha -->
<div class="modal" id="clientModal" aria-modal="true" role="dialog">
  <div class="sheet">
    <div class="close" data-close>‚úï</div>
    <div style="display:flex;gap:12px;align-items:center">
      <div id="mRing" class="avatar-wrap"><img id="mAvatar" class="avatar" alt="avatar"/></div>
      <div>
        <div id="mUser" style="font-weight:800"></div>
        <div class="muted" id="mName"></div>
        <div class="meta">
          <div><b id="mPosts"></b> posts</div>
          <div><b id="mFollowers"></b> seguidores</div>
          <div><b id="mFollowing"></b> siguiendo</div>
        </div>
      </div>
    </div>
    <div id="mBio" class="muted" style="margin-top:8px"></div>
    <div style="margin-top:12px;display:flex;gap:10px">
      <a class="btn" id="mOpen" target="_blank" rel="noopener">Abrir Instagram</a>
      <button class="btn primary">Crear campa√±a</button>
    </div>
  </div>
</div>

<!-- Icons -->
<svg style="position:absolute;width:0;height:0;overflow:hidden">
  <symbol id="igVerified" viewBox="0 0 24 24"><defs><radialGradient id="metaBlue" cx="50%" cy="40%" r="70%"><stop offset="0" stop-color="#67B7FF"/><stop offset="1" stop-color="#0B65FF"/></radialGradient></defs><path fill="url(#metaBlue)" d="M12 2.4l2.15 1.3 2.46-.14 1.15 2.17 2.17 1.15-.14 2.46 1.3 2.15-1.3 2.15.14 2.46-2.17 1.15-1.15 2.17-2.46-.14L12 21.6l-2.15-1.3-2.46.14-1.15-2.17-2.17-1.15.14-2.46L2.4 12l1.3-2.15-.14-2.46 2.17-1.15 1.15-2.17 2.46.14L12 2.4z"/><path fill="#fff" d="M10.25 14.6l-2.1-2.1 1.3-1.3 1.6 1.6 4.1-4.1 1.3 1.3-5.4 5.4z"/></symbol>
  <symbol id="ig" viewBox="0 0 24 24"><defs><linearGradient id="igG" x1="0" x2="1"><stop offset="0" stop-color="#ff7a00"/><stop offset="1" stop-color="#e600ff"/></linearGradient></defs><rect x="2" y="2" width="20" height="20" rx="5" fill="url(#igG)"/><circle cx="12" cy="12" r="4.2" fill="#fff"/><circle cx="18" cy="6" r="1.6" fill="#fff"/></symbol>
  <symbol id="tiktok" viewBox="0 0 24 24"><path fill="#25F4EE" d="M10 4h3v9a4 4 0 11-3.2-3.9V8.1A7 7 0 003 15a7 7 0 1011-5.8V4z"/><path fill="#FE2C55" d="M13 4a6 6 0 006 6V7a3 3 0 01-3-3h-3z"/><path fill="#fff" d="M13 7.8v5.2a4 4 0 11-3.2-3.9V7.8A7 7 0 003 15a7 7 0 1011-5.8z"/></symbol>
  <symbol id="yt" viewBox="0 0 24 24"><path fill="#FF0000" d="M22 12s0-4-1-5c-1-1-5-1-9-1s-8 0-9 1-1 5-1 5 0 4 1 5 5 1 9 1 8 0 9-1 1-5 1-5z"/><path fill="#fff" d="M10 15V9l6 3-6 3z"/></symbol>
  <symbol id="threads" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#000"/><path fill="#fff" d="M8.5 12c0 2.2 1.8 3.5 3.7 3.5 2.3 0 3.8-1.4 3.8-3.8 0-2.7-1.8-4.2-4.8-4.2h-.9V6h.8c3.9 0 6.5 2.2 6.5 5.9 0 3.2-2.4 5.3-5.6 5.3-3.2 0-5.5-2.1-5.5-5.2h1z"/></symbol>
  <symbol id="x" viewBox="0 0 24 24"><path fill="#fff" d="M17.5 4H20l-5.5 6 6 10h-5l-3.5-6-4 4-3-2 5-5-5-7h5l3 5 4.5-5z"/></symbol>
  <symbol id="fb" viewBox="0 0 24 24"><path fill="#1877F2" d="M22 12C22 6.48 17.52 2 12 2S2 6.48 2 12a10 10 0 008.5 9.87v-6.98H8.07v-2.9h2.43V9.41c0-2.4 1.43-3.73 3.63-3.73 1.05 0 2.15.19 2.15.19v2.36h-1.21c-1.19 0-1.56.74-1.56 1.49v1.79h2.65l-.42 2.9h-2.23V21.9A10 10 0 0022 12z"/></symbol>
  <symbol id="li" viewBox="0 0 24 24"><path fill="#0A66C2" d="M20.45 20.45H17V14.6c0-1.39-.5-2.34-1.75-2.34-.95 0-1.52.64-1.77 1.26-.09.22-.11.52-.11.82v6.11H9.89s.05-9.92 0-10.95h3.48v1.55c.46-.71 1.29-1.72 3.13-1.72 2.28 0 3.95 1.49 3.95 4.69v6.43zM7.34 8.94a2.02 2.02 0 110-4.04 2.02 2.02 0 010 4.04zM5.57 20.45h3.54V9.5H5.57v10.95z"/></symbol>
  <symbol id="sp" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#1DB954"/><path fill="#fff" d="M7 9c4-1 8 0 10 1 .5.2.7.8.5 1.3-.3.5-.9.6-1.4.4-1.8-.9-5-1.7-8.7-.7-.6.2-1.1-.2-1.3-.8-.2-.6.2-1.1.9-1.2zM7 12c3-.7 6 0 8 .7.4.1.7.6.5 1-.2.5-.7.6-1.2.4-1.6-.7-4.1-1.3-7.2-.6-.5.1-1-.2-1.1-.7-.1-.6.2-1 .9-1.2zM7 15c2-.4 4 .1 5.4.6.4.1.6.5.5.9-.1.4-.5.5-.9.4-1.2-.5-3-1-4.6-.6-.4.1-.8-.1-.9-.5-.1-.5.1-.8.5-.8z"/></symbol>
  <symbol id="tg" viewBox="0 0 24 24"><path fill="#229ED9" d="M9.6 16.8l-.4 3.7c.6 0 .9-.3 1.2-.6l2.8-2.7 5.8 4.3c1 .6 1.6.3 1.9-.9l3.4-16c.3-1.2-.4-1.7-1.3-1.4L2.2 9.9c-1.1.4-1.1 1.1-.2 1.4l5.6 1.7L18.8 6c.7-.4 1.2-.2.7.3"/></symbol>
  <symbol id="wa" viewBox="0 0 24 24"><path fill="#25D366" d="M20.5 3.5A10 10 0 003.6 20.4L2 22l1.8-.5a10 10 0 0014.3-14zM12 19a7 7 0 116.2-10.2A7 7 0 0112 19z"/><path fill="#25D366" d="M8.8 7.7c-.4 0-.7.3-.7.7 0 2.2 2.2 4.4 4.4 4.4.4 0 .7-.3 .7-.7 0-.2-.1-.5-.3-.6l-1.1-.6c-.1-.1-.3-.1-.4 0l-.3.2c-.6-.3-1.1-.8-1.4-1.4l.2-.3c.1-.1.1-.3 0-.4l-.6-1.1c-.1-.2-.4-.3-.6-.3z"/></symbol>
</svg>

<script>
/* ==== Config backend ==== */
const API_BASE=(location.hostname==='localhost'||location.hostname==='127.0.0.1')?'http://localhost:8000':'';
const api=(p)=>`${API_BASE}${p}`;
const avatarSrc=(u)=>api(`/avatar?username=${encodeURIComponent(u)}`);

/* Conexi√≥n */
(async()=>{try{const r=await fetch(api('/health')); if(r.ok){document.getElementById('conn').textContent='Conectado'; document.querySelector('.dot').style.background='var(--ok)';}}catch(_){}})();

/* Nav */
const views={home:document.getElementById('view-home'),clients:document.getElementById('view-clients'),farm:document.getElementById('view-farm'),accounts:document.getElementById('view-accounts'),network:document.getElementById('view-network')};
function showView(k){Object.entries(views).forEach(([key,v])=>{v.style.display= key===k?'block':'none'});document.querySelectorAll('.nav .item').forEach(i=>i.classList.toggle('active',i.dataset.go===k));window.scrollTo({top:0,behavior:'smooth'})}
document.querySelectorAll('.nav .item').forEach(i=>i.onclick=()=>showView(i.dataset.go)); showView('home');

/* Redes */
const networks=[
  {key:'instagram',name:'Instagram',icon:'#ig',services:['Likes','Comentarios','Seguidores','Vistas Reels','Compartidos','Guardados','Historias','Live Views']},
  {key:'tiktok',name:'TikTok',icon:'#tiktok',services:['Likes','Comentarios','Seguidores','Views','Shares','Live Views']},
  {key:'youtube',name:'YouTube',icon:'#yt',services:['Vistas','Likes','Comentarios','Suscriptores','Shorts Views','Live Views','Compartidos']},
  {key:'threads',name:'Threads',icon:'#threads',services:['Likes','Respuestas','Seguidores','Vistas','Reposts']},
  {key:'x',name:'X',icon:'#x',services:['Likes','Respuestas','Seguidores','Vistas','Reposts','Citas']},
  {key:'facebook',name:'Facebook',icon:'#fb',services:['Likes','Comentarios','Seguidores/P√°gina','Vistas','Compartidos','Live Views']},
  {key:'linkedin',name:'LinkedIn',icon:'#li',services:['Reacciones','Comentarios','Seguidores','Vistas','Compartidos']},
  {key:'spotify',name:'Spotify',icon:'#sp',services:['Streams','Saves','Oyentes mensuales','Playlist adds']},
  {key:'telegram',name:'Telegram',icon:'#tg',services:['Miembros','Vistas post','Forwards/Repost']},
  {key:'whatsapp',name:'WhatsApp',icon:'#wa',services:['Vistas de estado','Clicks','Mensajes masivos']},
  {key:'missu',name:'Miss Universe',icon:null,services:[]},
  {key:'beast',name:'Modo Bestia',icon:'#beastIcon',services:[]}
];
const socialGrid=document.getElementById('socialGrid');
socialGrid.innerHTML=networks.map(n=>{
  if(n.key==='beast'){return `<div class="card beast" data-beast><div class="logo-wrap"><svg width="24" height="24"><use href="#beastIcon"/></svg></div><div class="title">${n.name}</div></div>`}
  if(n.key==='missu'){return `<div class="card mu" data-net="missu"><div class="logo-wrap">üëë</div><div class="title" style="display:flex;align-items:center;gap:8px">Miss Universe <span class="pill">MU2025</span></div></div>`}
  return `<div class="card" data-net="${n.key}"><div class="logo-wrap"><svg width="28" height="28"><use href="${n.icon}"/></svg></div><div class="title">${n.name}</div></div>`
}).join('');
const netTitle=document.getElementById('networkTitle'), netSub=document.getElementById('networkSub'), netServices=document.getElementById('networkServices');
function openNetwork(key){
  const net=networks.find(x=>x.key===key); if(!net || !net.services.length){toast('Pr√≥ximamente');return;}
  netTitle.textContent=`Servicios ¬∑ ${net.name}`; netSub.textContent=`Automatiza ${net.name} con IA`;
  netServices.innerHTML=net.services.map(svc=>`
    <div class="client-card" style="min-height:auto">
      <div style="flex:1">
        <div class="client-title">${svc}</div>
        <input class="input" placeholder="${svc.includes('Seguidores') ? '@usuario' : 'URL / ID / Nota'}" style="margin:6px 0"/>
        <input class="input" placeholder="Cantidad" type="number" min="10"/>
      </div>
      <button class="btn primary" onclick="toast('Orden enviado')">Ordenar</button>
    </div>`).join('');
  showView('network');
}

/* Verified SVG */
const verified=()=>`<svg class="ig-verified" viewBox="0 0 24 24"><use href="#igVerified"/></svg>`;

/* Clients (persistencia) */
function loadClients(){
  const s=localStorage.getItem('krave-clients'); if(s){try{return JSON.parse(s)}catch{}}
  return [
    {user:'aaronmercury',name:'Aaron Mercurio',followers:'5.4M',posts:'543',following:'924',verified:true},
    {user:'televisadigital',name:'Televisa Digital',followers:'246K',posts:'5,779',following:'617',verified:true},
    {user:'joscanela',name:'Jos Canela',followers:'722K',posts:'63',following:'425',verified:true,closeFriend:true,hasStory:true},
    {user:'jimenagallegotv',name:'Jimena G√°llego',followers:'544K',posts:'3,328',following:'1,608',verified:true},
    {user:'elmalilla_',name:'MALI EL MALILLAA!!üá≤üáΩ',followers:'3.6M',posts:'675',following:'2,006',verified:true,closeFriend:true,hasStory:true},
    {user:'mariobautista',name:'Mario Bautista (MB)',followers:'6.7M',posts:'515',following:'3,371',verified:true},
    {user:'manuelturizo',name:'Manuel Turizo - MTZ',followers:'14.7M',posts:'131',following:'1300',verified:true,hasStory:true},
    {user:'cadillacf1',name:'Cadillac Formula 1 Team',followers:'1.1M',posts:'10',following:'82',verified:true,hasStory:true},
    {user:'pesopluma',name:'La Doble P',followers:'15.4M',posts:'44',following:'1191',verified:true}
  ];
}
let clients=loadClients(); const save=()=>localStorage.setItem('krave-clients',JSON.stringify(clients));

const recent=document.getElementById('recentList'); const grid=document.getElementById('clientsGrid');
function ring(c){return c.closeFriend?'ring-close':(c.hasStory?'ring-ig':'')}
const rowHTML=(c)=>`
  <div class="row">
    <div class="avatar-wrap ${ring(c)}"><img class="avatar" src="${avatarSrc(c.user)}" onerror="this.style.background='#2a3442'; this.removeAttribute('src')" alt=""/></div>
    <div class="grow">
      <div class="user">@${c.user} ${c.verified?verified():''}</div>
      <div class="muted">${c.name||''} ¬∑ ${c.followers||'0'} seguidores</div>
    </div>
    <a class="chip" href="#" data-open="${c.user}">Ver ficha</a>
    <div style="position:relative">
      <button class="dots">‚ãØ</button>
      <div class="menu"><button data-del="${c.user}">Eliminar</button></div>
    </div>
  </div>`;
const cardHTML=(c)=>`
  <div class="client-card" data-open="${c.user}">
    <div class="avatar-wrap ${ring(c)}"><img class="avatar" src="${avatarSrc(c.user)}" onerror="this.style.background='#2a3442'; this.removeAttribute('src')" alt=""/></div>
    <div class="grow">
      <div class="client-title">${c.name||c.user}${c.verified?verified():''}</div>
      <div class="client-sub">@${c.user}</div>
      <div class="client-meta">${c.followers||'0'} seguidores ¬∑ ${c.posts||'0'} posts</div>
    </div>
    <div style="position:relative">
      <button class="dots">‚ãØ</button>
      <div class="menu"><button data-del="${c.user}">Eliminar</button></div>
    </div>
  </div>`;
function paint(){
  recent.innerHTML=clients.map(rowHTML).join('');
  grid.innerHTML=clients.map(cardHTML).join('');
  save();
}
paint();

/* Enriquecer con /buscar-usuario (si est√°) */
async function enrich(username){
  try{
    const r=await fetch(api(`/buscar-usuario?username=${encodeURIComponent(username)}`));
    const j=await r.json(); const u=j.usuario||{}; const i=clients.findIndex(x=>x.user===username); if(i<0) return;
    const fmt=(n)=>new Intl.NumberFormat('en',{notation:'compact',maximumFractionDigits:1}).format(n||0);
    clients[i]={...clients[i],
      name:u.full_name||clients[i].name||username,
      followers:u.follower_count?fmt(u.follower_count):clients[i].followers,
      following:u.following_count??clients[i].following,
      posts:u.media_count??clients[i].posts,
      bio:u.biography||clients[i].bio,
      verified:u.is_verified!=null?!!u.is_verified:true
    };
    paint();
  }catch(_){}
}
['manuelturizo','cadillacf1','pesopluma','joscanela','elmalilla_'].forEach(enrich);

/* A√±adir cliente (persistente + enriquecimiento) */
async function addClientFlow(){
  const u=(prompt('Usuario (sin @):')||'').trim(); if(!u) return;
  const n=(prompt('Nombre para mostrar:')||u).trim();
  clients.unshift({user:u,name:n,followers:'0',posts:'0',following:'0',verified:true});
  paint(); toast('Cliente agregado'); enrich(u);
}
document.getElementById('addClientBtn').onclick=addClientFlow;
document.getElementById('addFromHome').onclick=()=>{showView('clients'); addClientFlow();};

/* Clicks globales */
document.addEventListener('click',(e)=>{
  const net=e.target.closest('[data-net]'); if(net){openNetwork(net.dataset.net); return;}
  const open=e.target.closest('[data-open]'); if(open){openCard(open.dataset.open); return;}
  const dots=e.target.closest('.dots'); if(dots){const m=dots.parentElement.querySelector('.menu'); document.querySelectorAll('.menu.show').forEach(x=>x.classList.remove('show')); m.classList.toggle('show'); return;}
  const del=e.target.closest('[data-del]'); if(del){const u=del.dataset.del; if(confirm('¬øEliminar este cliente?')){clients=clients.filter(x=>x.user!==u); paint(); toast('Cliente eliminado');} return;}
  if(!e.target.closest('.menu')) document.querySelectorAll('.menu.show').forEach(x=>x.classList.remove('show'));
  const beast=e.target.closest('[data-beast]'); if(beast){beast.classList.add('beast-hot'); setTimeout(()=>beast.classList.remove('beast-hot'),650); const c=document.createElement('div'); c.className='screen-circle'; c.style.left=(e.clientX-12)+'px'; c.style.top=(e.clientY-12)+'px'; document.body.appendChild(c); c.addEventListener('animationend',()=>c.remove());}
});

/* F1 destello */
document.getElementById('f1Btn').onclick=(e)=>{const b=document.createElement('div');b.className='f1-burst';b.style.left=(e.clientX-10)+'px';b.style.top=(e.clientY-10)+'px';document.body.appendChild(b);b.addEventListener('animationend',()=>b.remove())};

/* Ficha modal */
const modal=document.getElementById('clientModal');
function openCard(user){
  const c=clients.find(x=>x.user===user); if(!c) return;
  const ring = c.closeFriend?'ring-close':(c.hasStory?'ring-ig':'');
  const ringEl=document.getElementById('mRing'); ringEl.className='avatar-wrap ' + ring;
  const av=document.getElementById('mAvatar'); av.src=avatarSrc(c.user); av.onerror=function(){this.style.background='#2a3442'; this.removeAttribute('src')};
  document.getElementById('mUser').innerHTML=`@${c.user} ${c.verified?verified():''}`;
  document.getElementById('mName').textContent=c.name||'';
  document.getElementById('mPosts').textContent=c.posts||'0';
  document.getElementById('mFollowers').textContent=c.followers||'0';
  document.getElementById('mFollowing').textContent=c.following||'0';
  document.getElementById('mBio').textContent=c.bio||'';
  document.getElementById('mOpen').href=`https://instagram.com/${c.user}`;
  modal.classList.add('show');
}
modal.addEventListener('click',(e)=>{if(e.target===modal||e.target.hasAttribute('data-close')) modal.classList.remove('show')});

/* Farm */
const farmGrid=document.getElementById('farmGrid');
const devices=[{name:'iPhone 14 Pro ¬∑ iOS',id:'10.0.0.8'},{name:'Galaxy S23 ¬∑ Android',id:'10.0.0.9'},{name:'iPhone 13 ¬∑ iOS',id:'10.0.0.10'},{name:'Pixel 8 ¬∑ Android',id:'10.0.0.11'}];
farmGrid.innerHTML=devices.map(d=>`
  <div class="client-card" style="min-height:auto">
    <div style="font-weight:700">${d.name}</div>
    <div class="muted">${d.id}</div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="btn primary" onclick="toast('Asignar stream a ${d.name}')">Asignar stream</button>
      <button class="btn" onclick="toast('Limpiar ${d.name}')">Limpiar</button>
    </div>
  </div>`).join('');

/* Util */
function toast(m){const t=document.createElement('div');t.textContent=m;Object.assign(t.style,{position:'fixed',left:'50%',transform:'translateX(-50%)',bottom:'90px',background:'var(--card)',border:'1px solid var(--line)',padding:'10px 14px',borderRadius:'10px',zIndex:300});document.body.appendChild(t);setTimeout(()=>t.remove(),2200)}
function sendAction(){toast('Acci√≥n enviada')}
</script>
</body>
</html>